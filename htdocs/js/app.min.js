function loadAssignRoleForms(){var e=document.getElementById("assign-roles-operation").value;let t=document.getElementById("assign-roles-dynamic-form");t.innerHTML="","assign"===e?(console.log("assign clicked"),fetch("/api/app/template/assignrole/type?operation=assign").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'})):"unassign"===e&&fetch("/api/app/template/unassignrole?operation=unassign").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'})}function loadAssignRoleForms2(){var e=document.getElementById("AssignRole-UserType").value;let t=document.getElementById("assign-roles-other-fields-dynamic-form");t.innerHTML="",fetch("/api/app/template/assignrole/otherfields?category="+e).then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'})}function setCookie(e,t,o){var a,s="";o&&((a=new Date).setTime(a.getTime()+24*o*60*60*1e3),s="; expires="+a.toUTCString()),document.cookie=e+"="+t+s+"; path=/"}function loadRolesForm(){var e=document.getElementById("manage-roles-operation").value;let t=document.getElementById("manage-roles-dynamic-form");t.innerHTML="","create"===e?fetch("/api/app/template/createrole?operation=create").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'}):"update"===e?fetch("/api/app/template/updaterole?operation=update").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'}):"delete"===e&&fetch("/api/app/template/deleterole?operation=delete").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'})}function manageRoleSubmitForm(e){var t=new FormData;let o;"create"===e?(t.append("roleName",document.getElementById("roleName").value),t.append("roleCategory",document.getElementById("roleCategory").value),t.append("description",document.getElementById("description").value),o="/api/app/role/create"):"update"===e?(t.append("roleId",document.getElementById("roleId").value),t.append("roleName",document.getElementById("roleName").value),t.append("description",document.getElementById("description").value),o="/api/app/role/update"):"delete"===e&&(t.append("roleId",document.getElementById("roleId").value),o="/api/app/role/delete"),fetch(o,{method:"POST",body:t}).then(e=>e.json()).then(e=>{document.getElementById("result");(e.success?new Toast("Success","now",e.message):new Toast("Failure","now",e.message)).show(),loadRolesForm()}).catch(e=>{console.error("Error:",e),new Toast("Error","now","An error occurred.").show(),loadRolesForm()})}function fetchNewKural(){fetch("/api/app/addons/thirukkural").then(e=>e.json()).then(e=>{$("#line1").text(e.Line1),$("#line2").text(e.Line2),$("#kural-container").attr("data-bs-content",`
                <div class="thil-explanation">
                    <div class="text-center mb-2">
                        <strong class="text-primary">திருக்குறள்</strong>
                    </div>
                    <div class="mb-2">
                        <strong>குறள் எண்:</strong> ${e.Number}
                    </div>
                    <div class="mb-2">
                        <strong>அதிகாரம்:</strong> ${e.adikaram_name}
                    </div>
                    <div class="mb-2">
                        <strong>குறள்:</strong><br> ${e.Line1}<br> ${e.Line2}
                    </div>
                    <div class="mb-2">
                        <strong>குறள் விளக்கம்:</strong><br> ${e.mk}.
                    </div>
                    <div class="mb-2">
                        <strong>Translation:</strong><br> ${e.Translation}.
                    </div>
                    <div>
                        <strong>Explanation:</strong><br> ${e.explanation}.
                    </div>
                </div>
            `),$("#kural-container").popover("dispose").popover({trigger:"hover",placement:"bottom"})}).catch(e=>console.error("Error fetching new Kural:",e))}$(document).ready(function(){console.log("Assign Faculty js loaded"),$("#studentSections").select2({placeholder:"Student Sections",allowClear:!0,width:"100%"})}),$(document).ready(function(){$("#classForm").on("submit",function(e){e.preventDefault();let t={faculty_id:$("#facultyId").val(),subject_code:$("#subjectCode").val(),batch:$("#batch").val(),department:$("#department").val(),semester:$("#semester").val(),section:$("#section").val(),student_sections:$("#studentSections").val(),year:$("#year").val()};console.log("Form Data:",t);e=new Dialog("Assigning Faculty","Are you sure you want to assign faculty to the selected sections? "+{formData:t});e.setButtons([{name:"Assign Faculty",class:"btn-success",onClick:function(e){$.ajax({url:"/api/app/create/assignfaculty",type:"POST",data:t,success:function(e){console.log("response",e.message),new Toast("Status","now",e.message).show(),$("#classForm").trigger("reset")},error:function(e,t,o){console.error("Error assigning faculty:",o),new Toast("Error","now","Error assigning faculty").show()}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-danger",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show()})}),$(document).ready(function(){console.log("assigntutor is ready"),$("#assign-tutor-btn").click(function(e){console.log("assign-tutor-btn clicked"),e.preventDefault();var t,e=$("#assign-faculty_id").val(),o=$("#assign-batch").val(),a=$("#assign-department").val(),s=$("#assign-section").val();$("#assign-faculty_id").css("border-color",""),$("#assign-batch").css("border-color",""),$("#assign-department").css("border-color",""),$("#assign-section").css("border-color",""),""===e?($("#assign-faculty_id").css("border-color","red"),new Toast("now","error","Please fill the Faculty ID field").show()):""===a?($("#assign-department").css("border-color","red"),new Toast("now","error","Please fill the Department field").show()):""===o?($("#assign-batch").css("border-color","red"),new Toast("now","error","Please fill the Batch field").show()):""===s?($("#assign-section").css("border-color","red"),new Toast("now","error","Please fill the Section field").show()):($("#assign-faculty_id").css("border-color","green"),$("#assign-batch").css("border-color","green"),$("#assign-department").css("border-color","green"),$("#assign-section").css("border-color","green"),console.log("faculty_id: "+e),console.log("batch: "+o),console.log("department: "+a),console.log("section: "+s),(t=new FormData).append("faculty_id",e),t.append("batch",o),t.append("department",a),t.append("section",s),$.ajax({url:"/api/app/tutor/assign",type:"POST",data:t,contentType:!1,processData:!1,success:function(e){console.log(e),(e.success?new Toast("now","success","Tutor Assigned Successfully"):new Toast("now","error","Tutor Assign Failed: "+e.message)).show(),document.getElementById("assign-tutor-form").reset()},error:function(e,t,o){t="Tutor Assign Failed: "+t;500===e.status?(t+=" - "+e.responseJSON.message,document.getElementById("assign-tutor-form").reset()):404===e.status&&(t+=" - Resource not found",document.getElementById("assign-tutor-form").reset()),new Toast("now","error",t).show()}}),$("#assign-faculty_id").css("border-color",""),$("#assign-batch").css("border-color",""),$("#assign-department").css("border-color",""),$("#assign-section").css("border-color",""))})}),$(document).ready(function(){console.log("assignyearincharge is ready"),$("#assign-yearincharge-btn").click(function(e){console.log("assign-yearincharge-btn clicked"),e.preventDefault();var t,e=$("#assign-faculty_id").val(),o=$("#assign-batch").val(),a=$("#assign-department").val();$("#assign-faculty_id").css("border-color",""),$("#assign-batch").css("border-color",""),$("#assign-department").css("border-color",""),""===e?($("#assign-faculty_id").css("border-color","red"),new Toast("now","error","Please fill the Faculty ID field").show()):""===a?($("#assign-department").css("border-color","red"),new Toast("now","error","Please fill the Department field").show()):""===o?($("#assign-batch").css("border-color","red"),new Toast("now","error","Please fill the Batch field").show()):($("#assign-faculty_id").css("border-color","green"),$("#assign-batch").css("border-color","green"),$("#assign-department").css("border-color","green"),console.log("faculty_id: "+e),console.log("batch: "+o),console.log("department: "+a),(t=new FormData).append("faculty_id",e),t.append("batch",o),t.append("department",a),$.ajax({url:"/api/app/yearincharge/assign",type:"POST",data:t,contentType:!1,processData:!1,success:function(e){console.log(e),(e.success?new Toast("now","success","Year Incharge Assigned Successfully"):new Toast("now","error","Year Incharge Assign Failed: "+e.message)).show(),document.getElementById("assign-yearincharge-form").reset()},error:function(e,t,o){t="Year Incharge Assign Failed: "+t;500===e.status?(t+=" - "+e.responseJSON.message,document.getElementById("assign-yearincharge-form").reset()):404===e.status&&(t+=" - Resource not found",document.getElementById("assign-yearincharge-form").reset()),new Toast("now","error",t).show()}}),$("#assign-faculty_id").css("border-color",""),$("#assign-batch").css("border-color",""),$("#assign-department").css("border-color",""))})}),$("#class-wise-year-report-btn").click(function(){var e=this.value,a=document.getElementById("test_name_class_wise_year").value,s=document.getElementById("batch_class_wise_year").value,n=document.getElementById("department_class_wise_year").value,r=document.getElementById("semester_class_wise_year").value,a=a.replace(/\s/g,"");new Toast("Report","Now","Report is being generated.").show(),$.ajax({url:"/generate_year_report_classwise",type:"POST",data:{test_id:e},xhrFields:{responseType:"blob"},success:function(e){var t=new Date,t=t.getFullYear()+("0"+(t.getMonth()+1)).slice(-2)+("0"+t.getDate()).slice(-2)+("0"+t.getHours()).slice(-2)+("0"+t.getMinutes()).slice(-2)+("0"+t.getSeconds()).slice(-2),e=(new Toast("Report","Success","Report generated successfully.").show(),URL.createObjectURL(e)),o=document.createElement("a");o.href=e,o.download=a+n+s+r+"_Report_"+t+".pdf",document.body.appendChild(o),o.click(),document.body.removeChild(o)},error:function(e,t,o){new Toast("Report","Error","An error occurred while generating the report.").show()}})}),$(document).ready(function(){console.log("Approve script loaded [new loaded] "),$(".approve-btn").click(function(){console.log("Approve button clicked");let t=$(this);var e=t.data("contest-id");let o=t.data("student-id"),a=$("#pending-count"),s=parseInt(a.data("pending-count"));console.log("pendingCount: "+s),console.log("Approving registration for student "+o+" in contest "+e),t.prop("disabled",!0).html('<i class="fas fa-spinner fa-spin"></i> Approving...'),$.ajax({url:"/api/contest/confirmregistration",type:"POST",data:{contestId:e,studentId:o},success:function(e){$("#status-"+o).removeClass("bg-secondary").addClass("bg-success").text("Approved"),t.replaceWith('<span class="text-success">Approved</span>'),new Toast("now","success","Registration approved successfully").show(),s-=1,a.data("pending-count",s),a.text(s+" Pending")},error:function(){alert("An error occurred while processing the request."),t.prop("disabled",!1).html('<i class="fas fa-check"></i> Approve')}})})}),$(document).ready(function(){console.log("Register script loaded successfully"),$(".register-btn").click(function(){var e=$(this).data("contest-id"),a=$(this);a.prop("disabled",!0),a.html("Registering..."),$.ajax({url:"/api/contest/register",type:"POST",data:{contestId:e},success:function(e){new Toast("now","success","Registration successful").show(),a.html("Registered")},error:function(e,t,o){e=e.responseJSON?e.responseJSON.message:"Registration failed";new Toast("now","error",e+" Please try again later.").show(),a.html("Failed"),a.prop("disabled",!1)}})})}),$(document).ready(function(){console.log("createadmin is ready"),$("#admin-create-account-btn").click(function(){console.log("create admin account clicked");var e,t=$("#admin-username").val(),o=$("#admin-password").val(),a=$("#admin-email").val(),s=$("#admin-confirm-password").val();console.log("username: "+t),console.log("password: "+o),console.log("email: "+a),console.log("confirm_password: "+s),o!==s?alert("Passwords do not match"):((e=new FormData).append("user",t),e.append("password",o),e.append("email",a),e.append("confirm_password",s),$.ajax({url:"/api/app/create/admin",type:"POST",data:e,processData:!1,contentType:!1,success:function(e){console.log("create admin account success"),console.log(e),("success"===e.message?new Toast("now","success","Admin account created successfully"):new Toast("now","error","Error creating admin account")).show()},error:function(e){console.log("create admin account error"),console.log(e),new Toast("now","error","Error creating admin account").show()}}))})}),$("#create-subjects").on("click",function(){var e,o=new FormData,a=$("#subjectFile")[0].files[0];a?(e=a.name.split(".").pop().toLowerCase(),-1===[".xls",".xlsx"].indexOf("."+e)?alert("Please upload a valid Excel file (.xls or .xlsx)"):((e=new Dialog("Creating Subjects","Are you sure you want to create new subjects? ")).setButtons([{name:"Create Subjects",class:"btn-primary",onClick:function(e){o.append("subjects_file",a);var t=new Toast("New","now","Creating subjects");t.show(),$.ajax({url:"/api/app/create/subjects",type:"POST",data:o,processData:!1,contentType:!1,success:function(e){console.log("Subjects created successfully:",e),(t=new Toast("Success","now",e.successCount+" Subjects created successfully")).show()},error:function(e){console.log("Error creating subjects:",e),alert("An error occurred while creating subjects. Please try again.")}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){console.log("Subject creation cancelled."),$(e.data.modal).modal("hide")}}]),e.show())):alert("Please select a file to upload.")}),$(document).ready(function(){console.log("create test js loaded [new]");let a=1;$("#subjectsContainer").on("click",function(e){var t,o;$(e.target).hasClass("addSubjectBtn")?(e.preventDefault(),t=$("#subjectTemplate").html(),(o=$("<div>").addClass("input-group mb-2")).html(`
                <select class="form-select" name="subjects[${a}][code]" required>
                    ${t}
                </select>
                <input type="date" class="form-control" name="subjects[${a}][date]" required>
                <button type="button" class="btn btn-danger removeSubjectBtn">-</button>
            `),$("#subjectsContainer").append(o),a++):$(e.target).hasClass("removeSubjectBtn")&&$(e.target).closest(".input-group").remove()})}),$(document).ready(function(){console.log("create test js loaded [form]"),$("#createTestForm").on("submit",function(e){e.preventDefault();let a={testname:$("#testname").val(),month:$("#month").val(),batch:$("#batch").val(),semester:$("#semester").val(),year:$("#year").val(),department:$("#department").val(),subjects:[],duration:$("#duration").val(),totalmarks:$("#totalmarks").val(),passmarks:$("#passmarks").val(),instructions:$("#instructions").val()};$("#subjectsContainer .input-group").each(function(e){var t=$(this).find('select[name^="subjects"]').val(),o=$(this).find('input[type="date"]').val();t&&o&&a.subjects.push({subject_code:t,date:o})}),console.log(a);e=new Dialog("Creating Test","Are you sure you want to create this test? "+{formData:a});e.setButtons([{name:"Create Test",class:"btn-success",onClick:function(e){$.ajax({url:"/api/app/create/createtest",type:"POST",data:a,success:function(e){console.log("response",e.message),new Toast("Status","now",e.message).show(),$("#createTestForm").trigger("reset")},error:function(e,t,o){console.error("Error creating test:",o),new Toast("Error","now","Error creating test").show()}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-danger",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show()})}),$("#create-users").on("click",function(){var o=new FormData,a=$('input[name="userType"]:checked').val(),s=$('input[name="role"]:checked').val(),n=$("#formFile-usercreate")[0].files[0];if("multiple"===a){if(!n)return void alert("Please select a file to upload.");var e=n.name.split(".").pop().toLowerCase();if(-1===[".xls",".xlsx"].indexOf("."+e))return void alert("Please upload a valid Excel file (.xls or .xlsx)")}e=new Dialog("Creating User Profiles","Are you sure you want to create new users");e.setButtons([{name:"Create User",class:"btn-primary",onClick:function(e){o.append("userType",a),o.append("role",s),o.append("users_file",n);var t=new Toast("New","now","Creating profiles");t.show(),$.ajax({url:"/api/app/create/users",type:"POST",data:o,processData:!1,contentType:!1,success:function(e){console.log("User created successfully:",e),(t=new Toast("Success","now",e.successCount+" Users created successfully")).show()},error:function(e){console.log("Error creating user:",e),alert("An error occurred while creating the user. Please try again.")}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){console.log("User creation cancelled."),$(e.data.modal).modal("hide")}}]),e.show(),$("#formFile-usercreate").val("")}),$("#create-users-clear").on("click",function(){$("#formFile-usercreate").val("")}),$(document).ready(function(){var e;0<$("#date-wise-stud-atten").length&&(e={type:"pie",data:{labels:["Present","Absent","On-Duty","Not Marked"],datasets:[{data:[(e=JSON.parse(document.getElementById("attendanceData").value)).summary.total_present??0,e.summary.total_absent??0,e.summary.total_on_duty??0,e.summary.total_not_marked??0],backgroundColor:["#28a745","#dc3545","#ffc107","#6c757d"],hoverOffset:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"},tooltip:{callbacks:{label:function(e){var t=e.label||"",o=e.raw;return t+`: ${o} (${(o/e.dataset.data.reduce((e,t)=>e+t,0)*100).toFixed(2)}%)`}}}}}},new Chart(document.getElementById("attendanceChart"),e))}),$(document).ready(function(){console.log("enrollmennt js loaded"),$("#enroll-subjects").select2({placeholder:"Select subjects",allowClear:!0,width:"100%"})}),$("#fetch-students-btn").on("click",function(e){e.preventDefault(),console.log("fetch-students-btn clicked");var t=new FormData($("#subject-selection-form")[0]);(t.getAll("subjects[]").length?((e=new Dialog("Fetching Students","Are you sure you want to fetch students for the selected subjects?")).setButtons([{name:"Fetch Students",class:"btn-primary",onClick:function(e){new Toast("Fetching","now","Fetching students").show(),$.ajax({url:"/api/app/template/enrollsubstud",type:"POST",data:t,processData:!1,contentType:!1,success:function(e){console.log("Students fetched successfully:",e),new Toast("Success","now","Students fetched successfully").show(),$("#subjects-list-container").empty(),"string"==typeof e?$("#subjects-list-container").append(e):e&&e.html?$("#subjects-list-container").append(e.html):console.error("Unexpected response format:",e),$("#subjects-list-container").show()},error:function(e){(errortoast=new Toast("Failed","now","Students not found")).show(),console.error("Error fetching students:",e)}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){new Toast("Cancelled","now","Fetching students cancelled").show(),$(e.target).closest(".modal").modal("hide")}}]),e):new Toast("Error","now","Please select subjects")).show()}),$(document).ready(function(){if(console.log("Faculty Timetable JS loaded"),0<$(".faculty-timetable-cont").length){console.log("Faculty Timetable page detected");let r=document.getElementById("weeklyTimetable"),a=document.getElementById("showAllButton");var e=document.getElementById("faculty_id").value;function c(e){var t=document.querySelectorAll(".day-card");let o="Show All"===a.textContent;t.forEach(e=>{e.classList.contains("current-day")||(o?e.classList.remove("blurred"):e.classList.add("blurred"))}),a.textContent=o?"Show Only Today":"Show All",e.layout()}$.ajax({url:"/api/app/get/tt/facultytimetable",type:"POST",data:{faculty_id:e},success:function(o){if(o.success){o=o.timetable;{var n=o;let s=(new Date).toLocaleString("en-US",{weekday:"long"}),e=(["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].forEach((e,t)=>{var o=n[e]||[];let a="";0<o.length?o.forEach(e=>{a+=`
                    <div class="class-details mb-2 bg-dark-light">
                        <p><strong>${e.department} - ${e.class} - ${e.section}</strong></p>
                        <p>${e.time} | Sem: ${e.semester}</p>
                    </div>
                `}):a='<p class="no-classes">No classes scheduled</p>',r.innerHTML+=`
            <div class="col" data-order="${t}">
                <div class="card day-card shadow-sm ${e===s?"current-day":""}" data-day="${e}">
                    <div class="day-header">
                        <i class="icon fa-solid fa-calendar-day"></i>
                        <div>${e}</div>
                    </div>
                    <div class="card-body">
                        ${a}
                    </div>
                </div>
            </div>
        `}),Array.from(r.children)),t=(e.sort((e,t)=>e.getAttribute("data-order")-t.getAttribute("data-order")),e.forEach(e=>r.appendChild(e)),new Masonry(r,{itemSelector:".col",columnWidth:".col",percentPosition:!0}));c(t)}}else console.error("Failed to fetch timetable data")},error:function(e,t,o){console.error("Error occurred while fetching timetable:",o)}}),window.toggleShowAll=c}}),$(document).ready(function(){setInterval(function(){var e=$("#footer-text-1"),t=$("#footer-text-2");e.is(":visible")?e.fadeOut("slow",function(){t.fadeIn("slow")}):t.fadeOut("slow",function(){e.fadeIn("slow")})},5e3)}),$(document).ready(function(){$("#signOutBtn").on("click",function(e){e.preventDefault();e=new Dialog("Sign out Confirmation","Are you sure you want to sign out?");e.setButtons([{name:"Sign Out",class:"btn-danger",onClick:function(e){$.ajax({url:"/api/auth/logout",type:"POST",success:function(e){window.location.href="/"},error:function(e){alert("Error signing out. Please try again.")}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-success",onClick:function(e){console.log("User canceled sign out."),$(e.data.modal).modal("hide")}}]),e.show()})}),$("#generateExcel-btn").click(function(){var e=new FormData,o=$("#batch").val(),a=$("#semester").val(),s=$("#section").val(),n=$("#subject_code").val(),r=$("#department").val(),c=$("#test_name").val(),t=$("#faculty_id").val();e.append("batch",o),e.append("semester",a),e.append("section",s),e.append("subject_code",n),e.append("department",r),e.append("test_name",c),e.append("faculty_id",t),console.log(o,a,s,n,r,c,t),console.log(e),$.ajax({url:"/generate_class_sub_excel",type:"POST",data:e,processData:!1,contentType:!1,xhrFields:{responseType:"blob"},success:function(e){var e=window.URL.createObjectURL(e),t=document.createElement("a");t.href=e,t.download="report_"+o+"_"+a+"_"+s+"_"+n+"_"+r+"_"+c+".xlsx",t.click(),window.URL.revokeObjectURL(e)},error:function(e,t,o){console.error("Error:",o)}})}),$(document).ready(function(){let r="/api/app/permission",a=$("#permissionForm"),s=$("#permissionsTable"),c=!1,l=null;function i(e){s.find(`tr[data-id="${e.permission_id}"]`).remove();e=`
                <tr data-id="${e.permission_id}">
                    <td>${e.permission_name}</td>
                    <td>${e.description}</td>
                    <td>${e.permission_category}</td>
                    <td>
                        <button class="btn btn-warning btn-sm editPermission" data-id="${e.permission_id}" data-name="${e.permission_name}">Edit</button>
                        <button class="btn btn-danger btn-sm deletePermission" data-id="${e.permission_id}" data-name="${e.permission_name}">Delete</button> 
                    </td>
                </tr>
            `;s.prepend(e)}function d(){a[0].reset()}$(a).on("submit",function(e){e.preventDefault();let t=document.getElementById("permission_name").value,o=document.getElementById("description").value,a=document.getElementById("permission_category").value,s={permission_name:t,description:o,permission_category:a};var n;c?(s.permission_id=l||null,(n=new Dialog("Update Permission",'<div style="font-size: 16px; line-height: 1.6;"><strong>Are you sure you want to update the permission as below?</strong><br><br><strong>Permission Name:</strong> '+t+"<br><strong>Description:</strong> "+o+"<br><strong>Permission Category:</strong> "+a+"<br></div>")).setButtons([{name:"Update",class:"btn-primary",onClick:function(e){$.ajax({url:r+"/update",method:"POST",data:s,success:function(e){new Toast("now","success",e.message).show();e={permission_name:t,description:o,permission_category:a,permission_id:e.permission_id};console.log(e),i(e),d(),$('#permissionForm button[type="submit"]').text("Create"),c=!1,l=null,$("#cancelPermission").remove()},error:function(e){let t="An error occurred";t=409===e.status?"No changes Made.":500===e.status?"Please try again later.":e.responseJSON?.message||"Unknown error occurred.",new Toast("now","error",t).show(),console.error("Error creating permission:",e),d(),$('#permissionForm button[type="submit"]').text("Create"),c=!1,l=null,$("#cancelPermission").remove()}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){d(),$('#permissionForm button[type="submit"]').text("Create"),c=!1,l=null,$("#cancelPermission").remove(),$(e.data.modal).modal("hide")}}])):(n=new Dialog("Create Permission",'<div style="font-size: 16px; line-height: 1.6;"><strong>Are you sure you want to create the permission below?</strong><br><br><strong>Permission Name:</strong> '+t+"<br><strong>Description:</strong> "+o+"<br><strong>Permission Category:</strong> "+a+"<br></div>")).setButtons([{name:"Create",class:"btn-primary",onClick:function(e){$.ajax({url:r+"/create",method:"POST",data:s,success:function(e){new Toast("now","success",e.message).show();e={permission_name:t,description:o,permission_category:a,permission_id:e.permissionId};i(e)},error:function(e){let t="An error occurred";t=409===e.status?"The permission already exists.":500===e.status?"Please try again later.":e.responseJSON?.message||"Unknown error occurred.",new Toast("now","error",t).show(),console.error("Error creating permission:",e)}}),d(),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){d(),$(e.data.modal).modal("hide")}}]),n.show()}),$(document).on("click",".editPermission",function(){var t,e=$(this).data("id"),e=($(this).data("name"),t=e),o=function(e){console.log("permission_name: "+e.permission_name),console.log("description: "+e.description),$("#permission_name").val(e.permission_name),$("#description").val(e.description),$("#permission_category").val(e.permission_category),c=!0,l=t,$('#permissionForm button[type="submit"]').text("Update"),$("#cancelPermission").length||$("#permissionForm").append('<button type="button" class="btn btn-secondary" id="cancelPermission" style="display:inline-block">Cancel</button>'),$("html, body").animate({scrollTop:a.offset().top},500)};e={permission_id:t},$.ajax({url:"/api/app/permission/get/by/id",method:"POST",data:e,success:function(e){console.log(e),o({permission_name:e.permission_name,description:e.description,permission_category:e.permission_category})},error:function(){new Toast("now","error","An error occurred").show()}})}),$(document).on("click","#cancelPermission",function(){console.log("Cancel button clicked"),d(),$('#permissionForm button[type="submit"]').text("Create"),c=!1,l=null,$("#cancelPermission").remove()}),$(document).on("click",".deletePermission",function(){var e=$(this).data("id"),t=$(this).data("name"),o=e,e=t;(e=new Dialog("Delete Permission","Are you sure you want to delete the permission "+e+"?")).setButtons([{name:"Delete",class:"btn-danger",onClick:function(e){var t;$.ajax({url:r+"/delete",method:"POST",data:{permission_id:o},success:function(){new Toast("now","success","Permission deleted successfully").show()},error:function(e,t,o){console.error("Error deleting permission"),new Toast("now","error","An error occurred").show()}}),t=o,s.find(`tr[data-id="${t}"]`).remove(),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show()})}),$(document).ready(function(){function o(){$.ajax({url:"/api/app/tutor/get/tutors",type:"POST",success:function(e){var t=$("#tutor-table tbody");t.empty();for(var o=0;o<e.tutors.length;o++){var a=e.tutors[o],s=$("<tr></tr>");s.append("<td>"+a.faculty_id+"</td>"),s.append("<td>"+a.faculty_name+"</td>"),s.append("<td>"+a.department+"</td>"),s.append("<td>"+a.batch+"</td>"),s.append("<td>"+a.section+"</td>"),s.append('<td><button class="btn btn-danger remove-tutor-btn" data-tutor-id="'+a.faculty_id+'"> Unassign </button></td>'),t.append(s)}},error:function(e){console.log(e),new Toast("now","error","Error loading Tutors or no Tutors found").show(),$("#tutor-table").hide(),$("#remove-tutor").empty(),$("#remove-tutor").append('<p class="alert alert-warning text-center">No Tutors found</p>')}})}console.log("removetutor is ready"),$(document).on("click",".remove-tutor-btn",function(){var e=$(this).data("tutor-id"),t=(console.log("remove-tutor-btn clicked"),console.log("tutor_id: "+e),new FormData);t.append("faculty_id",e),$.ajax({url:"/api/app/tutor/unassign",type:"POST",data:t,contentType:!1,processData:!1,success:function(e){console.log(e),new Toast("now","success","Tutor unassigned successfully").show(),o()},error:function(e){console.log(e),new Toast("now","error","Error unassigning Tutor").show()}}),o()}),$("#remove-tutor-container").length&&o()}),$("#markAttendance-container").ready(function(){console.log("markAttendance-container ready"),$("#classSelect-att").on("change",function(){$("#submitAttendanceBtn").show();var e,t=$("#classSelect-att").val(),o=(console.log("classId: "+t),$("#classSelect-att option:selected").data("section")),a=$("#classSelect-att option:selected").data("subject"),s=$("#classSelect-att option:selected").data("batch"),n=$("#classSelect-att option:selected").data("semester"),r=$("#classSelect-att option:selected").data("date"),c=$("#classSelect-att option:selected").data("day"),l=$("#classSelect-att option:selected").data("timeslot"),i=$("#classSelect-att option:selected").data("department");null==t||null==o||null==a||null==s||null==n||null==r||null==c||null==l?($("#attendanceAlert").show(),$("#attendanceTemplate").html(""),$("#submitAttendanceBtn").hide()):(console.log("section: "+o),console.log("subject: "+a),console.log("batch: "+s),console.log("semester: "+n),console.log("date: "+r),console.log("day: "+c),console.log("timeslot: "+l),console.log("department: "+i),(e=new FormData).append("classId",t),e.append("section",o),e.append("department",i),e.append("subjectCode",a),e.append("batch",s),e.append("semester",n),e.append("date",r),e.append("day",c),e.append("timeslot",l),$("#attendanceAlert").hide(),console.log("classSelect-att changed"),$.ajax({url:"/api/app/template/attendance/studentslist",type:"POST",data:e,contentType:!1,processData:!1,success:function(e){console.log("response: "+e),$("#attendanceTemplate").html(e),$("#submitAttendanceBtn").show()},error:function(e){console.log("response: "+e)}}))}),$("#submitAttendanceBtn").on("click",function(e){console.log("submitAttendanceBtn clicked"),e.preventDefault();var a,o,s,t,n,r,c=$("#facultyId-markatt").val(),e=$("#classSelect-att").val(),l=$("#classSelect-att option:selected").data("section"),i=$("#classSelect-att option:selected").data("subject"),d=$("#classSelect-att option:selected").data("department"),u=$("#classSelect-att option:selected").data("batch"),p=$("#classSelect-att option:selected").data("semester"),m=$("#classSelect-att option:selected").data("date"),g=$("#classSelect-att option:selected").data("day"),h=$("#classSelect-att option:selected").data("timeslot");console.log("classId:",e),console.log("section:",l),console.log("subject:",i),console.log("batch:",u),console.log("semester:",p),console.log("date:",m),console.log("day:",g),console.log("timeslot:",h),(e?(a=[],$("#attendanceTemplate tbody tr").each(function(){var e=$(this).find("td:eq(2)").text().trim(),t=(console.log("studentName:",e),$(this).find("td:eq(1)").text().trim()),o=$(this).find('input[type="radio"]:checked').val();t&&o&&a.push({name:e,id:t,status:o})}),console.log("attendanceData:",a),o=[],s=[],t=[],a.forEach(function(e){"absent"===e.status?o.push(e.id):"on-duty"===e.status?s.push(e.id):"present"===e.status&&t.push(e.id)}),e=o.length,n=s.length,r=t.length,(r=new Dialog("Attendance","<div><p><strong>Total Students Count:</strong> "+(e+n+r)+"</p><p><strong>Present Students Count:</strong> "+r+"</p><p><strong>Absent Students Count:</strong> "+e+"</p>"+(0<e?'<div class="table-responsive"><table class="table table-bordered"><thead><tr><th>S.No</th><th>Student Name</th><th>Reg No</th><th>Status</th></tr></thead><tbody>'+o.map(function(t,e){return"<tr><td>"+(e+1)+"</td><td>"+a.find(e=>e.id===t).name+"</td><td>"+t+"</td><td>Absent</td></tr>"}).join("")+"</tbody></table>":"")+"</div><p><strong>On Duty Students Count:</strong> "+n+"</p>"+(0<n?'<div class="table-responsive"><table class="table table-bordered"><thead><tr><th>S.No</th><th>Student Name</th><th>Student ID</th><th>Status</th></tr></thead><tbody>'+s.map(function(t,e){return"<tr><td>"+(e+1)+"</td><td>"+a.find(e=>e.id===t).name+"</td><td>"+t+"</td><td>On Duty</td></tr>"}).join("")+"</tbody></table>":"")+"</div></div>")).setButtons([{name:"Mark Attendance",class:"btn-success",onClick:function(e){var t;console.log("Marking attendance"),console.log("absentStudents:",o),console.log("onDutyStudents:",s),0===a.length?alert("Please mark attendance for at least one student."):((t=new FormData).append("department",d),t.append("facultyId",c),t.append("date",m),t.append("day",g),t.append("subjectCode",i),t.append("section",l),t.append("timeslot",h),t.append("batch",u),t.append("semester",p),t.append("attendanceData",JSON.stringify(a)),console.log("Form data prepared."),$.ajax({url:"/api/app/attendance/save",type:"POST",data:t,contentType:!1,processData:!1,success:function(e){console.log("Response:",e),localStorage.setItem("toastData",JSON.stringify({title:"Success",message:"Attendance marked successfully",type:"success"})),location.reload()},error:function(e,t,o){console.error("Error:",o),console.error("Response:",e.responseText);o=JSON.parse(e.responseText);console.log(JSON.stringify({message:o.message})),localStorage.setItem("toastData",JSON.stringify({title:"Failed",message:o.message,type:"error"})),location.reload()}}),$(e.data.modal).modal("hide"))}},{name:"Cancel",class:"btn-danger",onClick:function(e){console.log("Attendance marking cancelled"),$(e.data.modal).modal("hide")}}]),r):new Toast("Error","now","Please select a class to mark attendance")).show()})}),$(document).ready(function(){var e=localStorage.getItem("toastData");e&&(e=JSON.parse(e),new Toast(e.title,"now",e.message).show(),localStorage.removeItem("toastData"))}),$(document).ready(function(){$("#student-select").on("change",function(){var e=this.options[this.selectedIndex],t=e.dataset.regno,o=e.dataset.name,e=e.dataset.marks;$("#reg-no").val(t),$("#student-name").val(o),$("#current-marks").val(e),$("#update-form").removeClass("d-none")}),$("#reset-btn").on("click",function(){$("#student-select").val(""),$("#update-form").addClass("d-none")}),$("#update-btn").on("click",function(){var e=$("#reg-no").val(),o=$("#updated-marks").val(),a=$("#update-form"),s=a.data("batch"),n=a.data("semester"),r=a.data("subject_code"),c=a.data("testname"),l=a.data("section"),a=a.data("department");if(console.log(e,o,s,n,r,c,l,a),o.trim()){(updatingToast=new Toast("Updating","now","Updating marks")).show();let t=new FormData;t.append("reg_no",e),t.append("new_mark",o),t.append("batch",s),t.append("semester",n),t.append("subject_code",r),t.append("testname",c),t.append("section",l),t.append("department",a);e=new Dialog("Update Marks","Are you sure to update mark as "+o+"?");e.setButtons([{name:"Update Mark",class:"btn-success",onClick:function(e){$.ajax({url:"/api/app/update/updatemark",type:"POST",data:t,processData:!1,contentType:!1,success:function(e){console.log("Marks updated successfully:",e),new Toast("Success","now","Marks updated successfully").show(),$("#update-form").find("input").val(""),$("#student-select").val("").trigger("change"),$("#update-form").addClass("d-none")},error:function(e){console.error("Error updating marks:",e),(errortoast=new Toast("Failed","now","Marks not updated")).show()}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){new Toast("Cancelled","now","Update Marks Cancelled").show(),$(e.data.modal).modal("hide")}}]),e.show()}else alert("Please enter new marks.")}),$("#back-btn").on("click",function(){window.history.back()}),$("#edit-back-btn").on("click",function(){window.history.back()})}),Array.from(document.querySelectorAll('[data-bs-toggle="tooltip"]')).forEach(e=>{new bootstrap.Tooltip(e)}),$(document).ready(function(){let t=$(".sidebar-cus"),o=$(".sidebar-expand"),a=$(".sidebar-overlay");o.click(function(){t.toggleClass("visible"),a.toggleClass("visible")}),$(document).click(function(e){t.is(e.target)||t.has(e.target).length||o.is(e.target)||o.has(e.target).length||(t.removeClass("visible"),a.removeClass("visible"))}),t.click(function(e){e.stopPropagation()}),o.click(function(e){e.stopPropagation()})}),$(document).ready(function(){function o(){$.ajax({url:"/api/app/yearincharge/get/yearincharge",type:"POST",success:function(e){var t=$("#yearincharge-table tbody");t.empty();for(var o=0;o<e.yearincharges.length;o++){var a=e.yearincharges[o],s=$("<tr></tr>");s.append("<td>"+a.faculty_id+"</td>"),s.append("<td>"+a.faculty_name+"</td>"),s.append("<td>"+a.department+"</td>"),s.append("<td>"+a.batch+"</td>"),s.append('<td><button class="btn btn-danger remove-yearincharge-btn" data-yearincharge-id="'+a.faculty_id+'">Remove</button></td>'),t.append(s)}},error:function(e){console.log(e),new Toast("now","error","Error loading year in charges or no year in charges found").show(),$("#yearincharge-table").hide(),$("#remove-yearincharge").empty(),$("#remove-yearincharge").append('<p class="alert alert-warning text-center">No year in charges found</p>')}})}console.log("removeyearincharge is ready"),$(document).on("click",".remove-yearincharge-btn",function(){var e=$(this).data("yearincharge-id"),t=(console.log("remove-yearincharge-btn clicked"),console.log("yearincharge_id: "+e),new FormData);t.append("faculty_id",e),$.ajax({url:"/api/app/yearincharge/remove",type:"POST",data:t,contentType:!1,processData:!1,success:function(e){console.log(e),new Toast("now","success","Year in charge removed successfully").show(),o()},error:function(e){console.log(e),new Toast("now","error","Error removing year in charge").show()}}),o()}),$("#remove-yearincharge-container").length&&o()}),$(document).ready(function(){console.log("Role Permission Manage JS Loaded [updated]");let n=[],r=[];async function t(e=""){return console.log("Loading Permissions"),$("#permissions-container").empty(),n=[],$.ajax({url:"/api/app/permission/get/all",method:"POST",data:{search:e},success:function(e){n=e.map(e=>({id:e._id.$oid,name:e.permission_name,category:e.permission_category,description:e.description})),console.log("Permissions Data Loaded:",n)},error:function(e){console.error("Error fetching permissions:",e)}})}function o(){console.log("Generating Permissions UI");let o=r.map(e=>e.id);var e,t=n.reduce((e,t)=>(e[t.category]=e[t.category]||[],e[t.category].push(t),e),{}),a=$("#permissions-container");for(e in a.empty(),t){var s=t[e],s=`
                <div class="mb-3">
                    <ul class="list-unstyled">
                        <li>
                            <button type="button" class="btn w-100 text-start" data-bs-toggle="collapse" data-bs-target="#category-${e}">
                                <i class="fas fa-chevron-right" id="arrow-${e}"></i> ${e}
                            </button>
                            <div id="category-${e}" class="collapse mb-3 show">
                                <ul class="list-unstyled ms-4">
                                    ${s.map(e=>{var t=o.includes(e.id)?"checked":"";return`
                                            <li>
                                                <div class="form-check">
                                                    <input class="form-check-input permission-checkbox" type="checkbox" name="permissions[]" 
                                                        value="${e.id}" id="perm-${e.id}" ${t}>
                                                    <label class="form-check-label" for="perm-${e.id}" data-bs-toggle="tooltip" 
                                                        data-bs-placement="right" title="${e.description}">
                                                        ${e.name}
                                                    </label>
                                                </div>
                                            </li>
                                        `}).join("")}
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>`;a.append(s)}$('[data-bs-toggle="tooltip"]').tooltip()}function a(e=0){r=(n=(1==e||$("#rolePermissionForm").trigger("reset"),$("#permissions-container").empty(),[]),[])}$("#permission-role").on("change",function(){let e=$(this).val();console.log("Role Changed to:",e),a(1),(async()=>{try{console.log("Loading role and permissions"),await Promise.all([(async e=>(console.log("Loading Role Permissions"),r=[],$.ajax({url:"/api/app/permission/get/by/role",method:"POST",data:{roleId:e},success:function(e){e.success&&Array.isArray(e.permission)?(r=e.permission.map(e=>({id:e.id,name:e.name,category:e.category,description:e.description})),console.log("Role Permissions Loaded:",r)):console.error("Invalid response structure:",e)},error:function(e){console.error("Error fetching role permissions:",e)}})))(e),t()]),console.log("Permissions and Role Data Loaded"),o()}catch(e){console.error("Error loading role and permissions:",e),t().then(()=>o())}})()}),$("#role-permission-search").on("input",function(){let a=$(this).val().toLowerCase();$("#permissions-container .mb-3").each(function(){var e=$(this),t=e.find(".form-check");let o=!1;t.each(function(){var e=$(this).find("label").text().toLowerCase().includes(a);$(this).toggle(e),e&&(o=!0)}),o?(e.show(),e.find(".collapse").collapse("show")):e.hide()})}),$("#rolePermissionForm").on("submit",function(e){e.preventDefault();var e=$("#permission-role").val(),t=$("input[name='permissions[]']:checked").map(function(){return $(this).val()}).get();let o=new FormData;o.append("roleId",e),t.forEach(e=>{o.append("permissionsID[]",e)}),$.ajax({url:"/api/app/permission/grant",method:"POST",processData:!1,contentType:!1,data:o,success:function(e){console.log("Permissions updated successfully:",e);var t=new Toast("now"," success","Permissions updated successfully");0<e.message.length&&(e=e.message.map(function(e){return e.name}),(e=new Dialog("Success Details",`<h6>Current Permissions for Role: ${$("#permission-role").find("option:selected").data("name")} </h6>
                                         <ul>
                                             <li>${e.join("</li><li>")}</li>
                                         </ul>`)).setButtons([{name:"Close",class:"btn-primary",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show()),a(),t.show()},error:function(e){console.error("Error saving permissions:",e),new Toast("now"," error","Error saving permissions").show()}})})}),console.log("sidebar.js loaded"),Array.from(document.querySelectorAll('[data-bs-toggle="tooltip"]')).forEach(e=>{new bootstrap.Tooltip(e),console.log("tooltipTriggerEl:",e)}),$(document).ready(function(){if(console.log("student Timetable JS loaded [updated]"),0<$(".student-timetable-cont").length){console.log("Student Timetable page detected");let r=document.getElementById("weeklyTimetable"),a=document.getElementById("showAllButton");var e=document.getElementById("student_id").value;function c(e){var t=document.querySelectorAll(".day-card");let o="Show All"===a.textContent;t.forEach(e=>{e.classList.contains("current-day")||(o?e.classList.remove("blurred"):e.classList.add("blurred"))}),a.textContent=o?"Show Only Today":"Show All",e.layout()}$.ajax({url:"/api/app/get/tt/studenttimetable",type:"POST",data:{student_id:e},success:function(o){if(o.success){o=o.timetable;{var n=o;let s=(new Date).toLocaleString("en-US",{weekday:"long"}),e=(["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].forEach((e,t)=>{var o=n[e]||[];let a="";0<o.length?o.forEach(e=>{a+=`
                    <div class="class-details mb-2 bg-dark-light">
                        <p><strong>${e.subject_code} - ${e.section}</strong></p>
                        <p><em>${e.faculty}</em></p>
                        <p>${e.time} | ${e.class}</p>
                    </div>
                `}):a='<p class="no-classes">No classes scheduled</p>',r.innerHTML+=`
            <div class="col mt-2" data-order="${t}">
                <div class="card day-card shadow-sm ${e===s?"current-day":""}" data-day="${e}">
                    <div class="day-header">
                        <i class="icon fa-solid fa-calendar-day"></i>
                        <div>${e}</div>
                    </div>
                    <div class="card-body">
                        ${a}
                    </div>
                </div>
            </div>
        `}),Array.from(r.children)),t=(e.sort((e,t)=>e.getAttribute("data-order")-t.getAttribute("data-order")),e.forEach(e=>r.appendChild(e)),new Masonry(r,{itemSelector:".col",columnWidth:".col",percentPosition:!0}));c(t)}}else console.error("Failed to fetch timetable data")},error:function(e,t,o){console.error("Error occurred while fetching timetable:",o)}}),window.toggleShowAll=c}}),$(document).ready(function(){if(console.log("summaryattstudent.js loaded"),0<$("#summary-attendance").length){document.querySelectorAll('tbody[id^="detailsBody-"]').forEach(e=>{let t=Array.from(e.children);e=e.id.split("-")[1];let o=document.getElementById("pagination-"+e);function a(e){let o=5*(e-1),a=5+o;t.forEach((e,t)=>{e.style.display=t>=o&&t<a?"":"none"})}var s=Math.ceil(t.length/5);o.innerHTML="";for(let t=1;t<=s;t++){let e=document.createElement("li");e.className="page-item",e.innerHTML=`<a class="page-link" href="#">${t}</a>`,e.addEventListener("click",()=>{a(t),o.querySelectorAll(".page-item").forEach(e=>e.classList.remove("active")),e.classList.add("active")}),o.appendChild(e)}o.firstChild&&o.firstChild.classList.add("active"),a(1)});var e={type:"bar",data:{labels:JSON.parse($("#summ-subjects").val()),datasets:[{label:"Attendance Percentage",data:JSON.parse($("#summ-percentages").val()),backgroundColor:"#4e73df",borderColor:"#375a7f",borderWidth:1}]},options:{responsive:!0,scales:{x:{title:{display:!0,text:"Subjects"}},y:{title:{display:!0,text:"Attendance (%)"},max:100}}}},t={type:"pie",data:{labels:JSON.parse($("#summ-subjects").val()),datasets:[{label:"Subject Contribution",data:JSON.parse($("#summ-percentages").val()),backgroundColor:["#4e73df","#1cc88a","#36b9cc","#f6c23e","#e74a3b","#858796","#5a5c69"]}]},options:{responsive:!0,plugins:{tooltip:{callbacks:{label:e=>e.raw+"%"}}}}};new Chart(document.getElementById("attendanceBarChart"),e),new Chart(document.getElementById("attendancePieChart"),t)}}),$(document).ready(function(){$("#kural-container").popover({trigger:"hover",placement:"top"})}),fetchNewKural();let isHovered=!1,kuralContainer=document.getElementById("kural-container");kuralContainer.addEventListener("mouseenter",()=>{isHovered=!0}),kuralContainer.addEventListener("mouseleave",()=>{isHovered=!1}),setInterval(()=>{isHovered||fetchNewKural()},6e4),$(document).ready(function(){$("#tt-subject_code").on("change",function(){var e=$(this).val();$.ajax({url:"/api/app/get/tt/batch",data:{subject_code:e},type:"POST",success:function(e){$("#tt-subject_name").val(e.subject_name);var o=$("#tt-batch");new Toast("now","success","Batches Loaded").show(),console.log(e.batches),$("#tt-batch").prop("disabled",!1),o.empty(),o.append($("<option>",{value:"",text:"Select the Batch"})),$.each(e.batches,function(e,t){o.append($("<option>",{value:t,text:t}))})},error:function(e){new Toast("now","error","No Batch Found. Please Assign the Subject to the Batch").show(),$("#tt-batch").prop("disabled",!0)}})}),$("#tt-batch").on("change",function(){console.log("Batch Changed");var e=$("#tt-subject_code").val(),t=$(this).val();console.log(e),console.log(t),$.ajax({url:"/api/app/get/tt/faculty",data:{subject_code:e,batch:t},type:"POST",success:function(e){console.log(e),$("#tt-faculty").empty(),$("#tt-faculty").prop("disabled",!1),$("#tt-semester").prop("disabled",!1),new Toast("now","success","Faculties Loaded").show(),$("#tt-faculty").append($("<option>",{value:"",text:"Select the Faculty"})),$.each(e.faculties,function(e,t){$("#tt-faculty").append($("<option>",{value:t.id,text:t.name+" ("+t.department+")"}))})},error:function(e){new Toast("now","error","No faculty Found. Please Assign the Subject to the faculty").show()}})}),$("#tt-faculty").on("change",function(){var e=$("#tt-subject_code").val(),t=$("#tt-batch").val(),o=$("#tt-semester").val(),a=$(this).val();$.ajax({url:"/api/app/get/tt/facultysections",data:{faculty_id:a,subject_code:e,batch:t,semester:o},type:"POST",success:function(e){console.log(e);new Toast("now","success","Class Loaded").show(),$("#tt-section").val(e.Sections[0]);var o=$("#tt-section");o.empty(),o.append($("<option>",{value:"",text:"Select the Section"})),$.each(e.Sections,function(e,t){o.append($("<option>",{value:t,text:t}))})},error:function(e,t){e=e.responseJSON?e.responseJSON.message:"No Class Found. Please Assign the Subject to the Class";new Toast("now","error",e).show(),console.error("Error:",e)}})}),$("#tt-section").on("change",function(){var e=$("#tt-subject_code").val(),t=$("#tt-batch").val(),o=$("#tt-semester").val(),a=$("#tt-faculty").val(),s=$(this).val(),n=$("#tt-department").val(),r=new FormData;r.append("faculty_id",a),r.append("department",n),r.append("subject_code",e),r.append("batch",t),r.append("semester",o),r.append("section",s),$.ajax({url:"/api/app/get/tt/classid",data:r,type:"POST",processData:!1,contentType:!1,success:function(e){console.log(e),new Toast("now","success","Class ID Loaded").show(),$("#tt-class_id").val(e.class_id)},error:function(e,t){e=e.responseJSON?e.responseJSON.message:"Error Loading Class ID";new Toast("now","error",e).show(),console.error("Error:",t)}})}),$("#tt-submit-btn").on("click",function(e){e.preventDefault();e=$("#timetable-form")[0];if(e.checkValidity()){var t=new FormData(e);let o=[];$("#day-slot-container .input-group").each(function(){var e=$(this).find('select[name="days[]"]').val(),t=$(this).find('select[name="slots[]"]').val();e&&t&&o.push({day:e,slot:t})}),t.append("daySlotPairs",JSON.stringify(o));var a,s,n=$("#tt-class-department").val()+$("#tt-room").val();t.append("class_room",n),console.log("Form Data [new] :",t);for([a,s]of t.entries())console.log(a,s);$.ajax({url:"/api/app/get/tt/assignslot",data:t,type:"POST",processData:!1,contentType:!1,success:function(e){new Toast("now","success","Timetable Slot Added").show(),console.log("Response:",e)},error:function(e,t){e=e.responseJSON?e.responseJSON.message:"Error Adding Timetable Slot";new Toast("now","error",e).show(),console.error("Error:",t)}})}else $(e).addClass("was-validated")}),$("#add-slot-btn").on("click",function(){let e=document.getElementById("day-slot-container"),t=document.createElement("div");t.className="input-group mb-2";var o=document.getElementById("day-slot-template").cloneNode(!0);o.className="form-select",o.name="days[]",o.required=!0,o.classList.remove("d-none");var a=document.getElementById("slot-template").cloneNode(!0),s=(a.className="form-select",a.name="slots[]",a.required=!0,a.classList.remove("d-none"),document.createElement("button"));s.type="button",s.className="btn btn-danger",s.innerHTML='<i class="bi bi-dash-circle"></i>',s.addEventListener("click",function(){e.removeChild(t)}),t.appendChild(o),t.appendChild(a),t.appendChild(s),e.appendChild(t)})}),$(document).ready(function(){function r(e,t){console.log("Loading Roles");var o=new FormData;o.append("category",e),o.append("user_id",t),$.ajax({url:"/api/app/template/userrole",method:"POST",data:o,processData:!1,contentType:!1,success:function(e){console.log("Roles fetched successfully"),c("Roles","Roles Fetched Successfully"),$("#roles-container").html(e),$('[data-bs-toggle="tooltip"]').tooltip(),console.log("Roles Loaded")},error:function(e,t,o){console.error("Error fetching roles:",o),c("Error","Failed to fetch roles.")}})}function c(e,t){new Toast("now",e,t).show()}function l(){$("#role-user-id").val(""),$("#user-info").html(""),$("#roles-container").html(""),console.log("Removing Submit Button"),$("#user-role-submit").removeClass("d-block"),$("#user-role-submit").addClass("d-none")}console.log("User Role Manage JS Loaded"),$("#user-role-category").on("change",function(){console.log("Category Changed:",$(this).val()),l()}),$("#role-fetch-user").on("click",function(){console.log("User Role Fetch Button Clicked"),$("#user-info").html(""),$("#roles-container").html("");let s=$("#role-user-id").val(),n=$("#user-role-category").val();if(n)if(s){var t=new FormData;let e="";if(t.append("category",n),"faculty"===n)t.append("facultyId",s),e="/api/app/get/faculty";else{if("student"!==n)return void console.error("Invalid category selected.");t.append("regNo",s),e="/api/app/get/student"}fetch(e,{method:"POST",body:t}).then(t=>t.ok?t.json():t.json().then(e=>{throw console.error("Error fetching user details:",e.message||"Unknown error occurred"),c("Error",e.message||"Error fetching user details"),new Error(`HTTP Error ${t.status}: `+t.statusText)})).then(o=>{if(!o._id)throw new Error("Unexpected response structure");{c("User Details","User Fetched Successfully");var a=`
                                <div class="col-md-12">
                                    <p><strong>Name:</strong> <em>${o.name}</em></p>
                                    <p><strong>Email:</strong> <em>${o.email}</em></p>
                                    <p><strong>Department:</strong> <em>${o.department||"N/A"}</em></p>
                                    <p><strong>Designation:</strong> <em>${o.designation||"N/A"}</em></p>
                                    <p><strong>Role:</strong> <em>${o.role||"N/A"}</em></p>
                                </div>
                    `;let t=`
                <strong>Name: </strong> ${o.name}</em>, 
                <strong>Department: </strong> ${o.department||"N/A"}</em>, 
                <strong>Role: </strong> ${o.role||"N/A"}</em>
                `,e=new Dialog("User Details",a);e.setButtons([{name:"Confirm",class:"btn-success",onClick:function(e){$("#user-info").html(t),r(n,s),console.log("Enabling Submit Button"),$("#user-role-submit").removeClass("d-none"),$("#user-role-submit").addClass("d-block"),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){l(),$(e.data.modal).modal("hide")}}]),e.show()}}).catch(e=>{console.error("Fetch error:",e)})}else console.error("User ID/Registration No cannot be empty.");else console.error("Please select a category first.")}),$("#user-role-submit").on("click",function(e){console.log("User Role Submit Button Clicked");let o=$("#user-role-category").val(),a=$("#role-user-id").val();if(o)if(a){var s=$("input[name='role[]']:checked").map(function(){return $(this).val()}).get();0===s.length&&(console.error("No roles selected."),s=[]),console.log("Selected Category:",o),console.log("Selected User ID:",a),console.log("Selected Roles:",s);let t=new FormData;t.append("category",o),t.append("user_id",a),s.forEach(e=>{t.append("roles_id[]",e)}),console.log("Submitting form data:",t),$.ajax({url:"/api/app/role/set",method:"POST",contentType:!1,processData:!1,data:t,success:function(e){e&&e.message&&0!==e.message.length?(console.log("Roles assigned successfully:",e),c("Success","Roles assigned successfully!"),Array.isArray(e.result)&&0<e.result.length?(e=e.result.map(function(e){return e.name}),(e=new Dialog("Success",`<h6>Current Roles for User: ${$("#role-user-id").val()} </h6>
                        <ul>
                            ${e.map(e=>`<li>${e}</li>`).join("")}
                        </ul>`)).setButtons([{name:"Close",class:"btn-info",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show(),r(o,a)):((e=new Dialog("Success",`<h6>Current Roles for User: ${$("#role-user-id").val()} </h6>
                        <p>No Roles Assigned</p>`)).setButtons([{name:"Close",class:"btn-secondary",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show())):c("Success","No roles assigned")},error:function(e,t,o){console.error("Error assigning roles:",o),c("Error","Failed to assign roles. Please try again.")}})}else console.error("User ID/Registration No cannot be empty.");else console.error("Please select a category first.")})}),$(document).ready(function(){console.log("viewattendance.js loaded edited");let s=$("#session-select"),n=[],r="";function c(t){var e=n.find(e=>e.session._id===t);if(e){let t=$("#attendance-table");t.empty();var o=1;e.attendance.forEach(e=>{t.append(`
                    <tr data-student-id="${e.student_id}">
                        <td>${o++}</td>
                        <td>${e.student_id}</td>
                        <td>${e.student_name}</td>
                        <td>
                            <span class="read-only">${e.status}</span>
                            <select class="edit-mode form-control" style="display:none;">
                                <option value="present" ${"present"===e.status?"selected":""}>Present</option>
                                <option value="absent" ${"absent"===e.status?"selected":""}>Absent</option>
                                <option value="on-duty" ${"on-duty"===e.status?"selected":""}>On-Duty</option>
                            </select>
                        </td>
                    </tr>
                `)}),$("#edit-all").show(),$("#save-all").hide()}}$(document).on("click","#viewattendancebtn",function(){console.log("viewattendance button clicked"),r=$(this).data("class-id"),console.log("Class ID:",r);var a=$("#facultyId-view-atten").val(),e=new Dialog("Choose the Date to view or edit the attendance",`
            <div class="form-group">
            <label for="attendanceDate">Choose Date:</label>
            <input type="date" id="attendanceDate" class="form-control" max="${(new Date).toISOString().split("T")[0]}" min="2025-01-01">
            <p id="Day"></p>
            </div>
        `);$(document).on("change","#attendanceDate",function(){var e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date($(this).val()).getDay()];$("#selectedDay").text("Selected Day: "+e)}),e.setButtons([{name:"View Attendance",class:"btn-success",onClick:function(e){s.empty(),$("#attendance-table").empty();var t=$("#attendanceDate").val(),o=(console.log("Date:",t),new FormData);o.append("faculty_id",a),o.append("class_id",r),o.append("date",t),$.ajax({url:"/api/app/attendance/get/attendance",type:"POST",data:o,processData:!1,contentType:!1,success:function(e){console.log("Attendance Data:",e),new Toast("Success","now","Attendance Fetched Successfully").show(),n=e.message,$("#attendance-view").show(),n.forEach(e=>{s.append(new Option(e.session.day+" "+e.session.timeslot,e.session._id))}),0<n.length&&c(n[0].session._id)},error:function(e,t,o){console.error("Error:",o),console.error("Response:",e.responseText);o=JSON.parse(e.responseText);console.log(JSON.stringify({message:o.message})),localStorage.setItem("toastData",JSON.stringify({title:"Failed",message:o.message,type:"error"})),location.reload()}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){new Toast("Cancelled","now","View Attendance Cancelled").show(),$(e.data.modal).modal("hide"),location.reload()}}]),e.show()}),s.change(function(){c(this.value)}),$("#edit-all").click(function(){$(".read-only").hide(),$(".edit-mode").show(),$(this).hide(),$("#save-all").show()}),$("#save-all").click(function(){var e=s.val();let o=[];document.querySelectorAll("#attendance-table tr").forEach(e=>{var t=e.dataset.studentId,e=e.querySelector(".edit-mode").value;o.push({id:t,status:e})});var t=new FormData;t.append("sessionId",e),t.append("attendanceData",JSON.stringify(o)),t.append("classId",r),t.append("edit",!0),console.log("Session ID:",e),console.log("Updates:",o),console.log("Class ID:",r),$.ajax({url:"/api/app/attendance/saveedit",method:"POST",data:t,processData:!1,contentType:!1,success:function(){new Toast("Success","now","Attendance Saved Successfully").show(),localStorage.setItem("toastData",JSON.stringify({title:"Success",message:"Attendance Saved Successfully.",type:"success"})),location.reload()},error:function(e,t,o){console.error("Error:",o),console.error("Response:",e.responseText);o=JSON.parse(e.responseText);console.log(JSON.stringify({message:o.message})),localStorage.setItem("toastData",JSON.stringify({title:"Failed",message:o.message,type:"error"}))}})})}),$(document).ready(function(){console.log("viewstudentdetails-tutor.js loaded"),$(".view-student-detail-tutor").on("click",function(){var a=$(this).data("student_id");console.log("Student ID: "+a),$.ajax({url:"/api/app/student/details",type:"POST",data:{student_id:a},success:function(e){var t=e.studentDetails,e=e.enrolledClasses,o=`
    <div class="container">
        <h3 class="mb-3 text-primary">Student Details</h3>
        <div class="row">
            <div class="col-md-6">
                <p><strong>Name:</strong> ${t.name}</p>
                <p><strong>Registration No:</strong> ${t.reg_no}</p>
                <p><strong>Email:</strong> ${t.email}</p>
                <p><strong>Roll No:</strong> ${t.roll_no}</p>
            </div>
            <div class="col-md-6">
                <p><strong>Semester:</strong> ${t.semester}</p>
                <p><strong>Section:</strong> ${t.section}</p>
            </div>
        </div>

        <h3 class="mt-4 mb-3 text-primary">Enrolled Classes</h3>
        <div class="list-group">
`;e.forEach(function(e){o+=`
        <div class="list-group-item">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Faculty:</strong> ${e.faculty}</p>
                    <p><strong>Department:</strong> ${e.department}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Subject Code:</strong> ${e.subject_code}</p>
                    <p><strong>Semester:</strong> ${e.semester}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Section:</strong> ${e.section}</p>
                     <p><strong>Batch:</strong> ${e.batch}</p>
                </div>
            </div>
        </div>
    `}),o+="</div></div>",new Dialog("Student Details ("+a+")",o,{size:"large"}).show()}})})});
//# sourceMappingURL=app.min.js.map