function loadAssignRoleForms(){var e=document.getElementById("assign-roles-operation").value;let t=document.getElementById("assign-roles-dynamic-form");t.innerHTML="","assign"===e?(console.log("assign clicked"),fetch("/api/app/template/assignrole/type?operation=assign").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'})):"unassign"===e&&fetch("/api/app/template/assignrole?operation=unassign").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'})}function loadAssignRoleForms2(){var e=document.getElementById("AssignRole-UserType").value;let t=document.getElementById("assign-roles-other-fields-dynamic-form");t.innerHTML="",fetch("/api/app/template/assignrole/otherfields?category="+e).then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'})}function setCookie(e,t,o){var n,s="";o&&((n=new Date).setTime(n.getTime()+24*o*60*60*1e3),s="; expires="+n.toUTCString()),document.cookie=e+"="+t+s+"; path=/"}function loadRolesForm(){var e=document.getElementById("manage-roles-operation").value;let t=document.getElementById("manage-roles-dynamic-form");t.innerHTML="","create"===e?fetch("/api/app/template/createrole?operation=create").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'}):"update"===e?fetch("/api/app/template/updaterole?operation=update").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'}):"delete"===e&&fetch("/api/app/template/deleterole?operation=delete").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'})}function manageRoleSubmitForm(e){var t=new FormData;let o;"create"===e?(t.append("roleName",document.getElementById("roleName").value),t.append("roleCategory",document.getElementById("roleCategory").value),t.append("description",document.getElementById("description").value),o="/api/app/role/create"):"update"===e?(t.append("roleId",document.getElementById("roleId").value),t.append("roleName",document.getElementById("roleName").value),t.append("description",document.getElementById("description").value),o="/api/app/role/update"):"delete"===e&&(t.append("roleId",document.getElementById("roleId").value),o="/api/app/role/delete"),fetch(o,{method:"POST",body:t}).then(e=>e.json()).then(e=>{document.getElementById("result");(e.success?new Toast("Success","now",e.message):new Toast("Failure","now",e.message)).show(),loadRolesForm()}).catch(e=>{console.error("Error:",e),new Toast("Error","now","An error occurred.").show(),loadRolesForm()})}$(document).ready(function(){console.log("Assign Faculty js loaded"),$("#studentSections").select2({placeholder:"Student Sections",allowClear:!0,width:"100%"})}),$(document).ready(function(){$("#classForm").on("submit",function(e){e.preventDefault();let t={faculty_id:$("#facultyId").val(),subject_code:$("#subjectCode").val(),batch:$("#batch").val(),department:$("#department").val(),semester:$("#semester").val(),section:$("#section").val(),student_sections:$("#studentSections").val(),year:$("#year").val()};console.log("Form Data:",t);e=new Dialog("Assigning Faculty","Are you sure you want to assign faculty to the selected sections? "+{formData:t});e.setButtons([{name:"Assign Faculty",class:"btn-success",onClick:function(e){$.ajax({url:"/api/app/create/assignfaculty",type:"POST",data:t,success:function(e){console.log("response",e.message),new Toast("Status","now",e.message).show(),$("#classForm").trigger("reset")},error:function(e,t,o){console.error("Error assigning faculty:",o),new Toast("Error","now","Error assigning faculty").show()}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-danger",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show()})}),$("#class-wise-year-report-btn").click(function(){var e=this.value,n=document.getElementById("test_name_class_wise_year").value,s=document.getElementById("batch_class_wise_year").value,a=document.getElementById("department_class_wise_year").value,r=document.getElementById("semester_class_wise_year").value,n=n.replace(/\s/g,"");new Toast("Report","Now","Report is being generated.").show(),$.ajax({url:"/generate_year_report_classwise",type:"POST",data:{test_id:e},xhrFields:{responseType:"blob"},success:function(e){var t=new Date,t=t.getFullYear()+("0"+(t.getMonth()+1)).slice(-2)+("0"+t.getDate()).slice(-2)+("0"+t.getHours()).slice(-2)+("0"+t.getMinutes()).slice(-2)+("0"+t.getSeconds()).slice(-2),e=(new Toast("Report","Success","Report generated successfully.").show(),URL.createObjectURL(e)),o=document.createElement("a");o.href=e,o.download=n+a+s+r+"_Report_"+t+".pdf",document.body.appendChild(o),o.click(),document.body.removeChild(o)},error:function(e,t,o){new Toast("Report","Error","An error occurred while generating the report.").show()}})}),$("#create-subjects").on("click",function(){var e,o=new FormData,n=$("#subjectFile")[0].files[0];n?(e=n.name.split(".").pop().toLowerCase(),-1===[".xls",".xlsx"].indexOf("."+e)?alert("Please upload a valid Excel file (.xls or .xlsx)"):((e=new Dialog("Creating Subjects","Are you sure you want to create new subjects? ")).setButtons([{name:"Create Subjects",class:"btn-primary",onClick:function(e){o.append("subjects_file",n);var t=new Toast("New","now","Creating subjects");t.show(),$.ajax({url:"/api/app/create/subjects",type:"POST",data:o,processData:!1,contentType:!1,success:function(e){console.log("Subjects created successfully:",e),(t=new Toast("Success","now",e.successCount+" Subjects created successfully")).show()},error:function(e){console.log("Error creating subjects:",e),alert("An error occurred while creating subjects. Please try again.")}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){console.log("Subject creation cancelled."),$(e.data.modal).modal("hide")}}]),e.show())):alert("Please select a file to upload.")}),$(document).ready(function(){console.log("create test js loaded [new]");let n=1;$("#subjectsContainer").on("click",function(e){var t,o;$(e.target).hasClass("addSubjectBtn")?(e.preventDefault(),t=$("#subjectTemplate").html(),(o=$("<div>").addClass("input-group mb-2")).html(`
                <select class="form-select" name="subjects[${n}][code]" required>
                    ${t}
                </select>
                <input type="date" class="form-control" name="subjects[${n}][date]" required>
                <button type="button" class="btn btn-danger removeSubjectBtn">-</button>
            `),$("#subjectsContainer").append(o),n++):$(e.target).hasClass("removeSubjectBtn")&&$(e.target).closest(".input-group").remove()})}),$(document).ready(function(){console.log("create test js loaded [form]"),$("#createTestForm").on("submit",function(e){e.preventDefault();let n={testname:$("#testname").val(),month:$("#month").val(),batch:$("#batch").val(),semester:$("#semester").val(),year:$("#year").val(),department:$("#department").val(),subjects:[],duration:$("#duration").val(),totalmarks:$("#totalmarks").val(),passmarks:$("#passmarks").val(),instructions:$("#instructions").val()};$("#subjectsContainer .input-group").each(function(e){var t=$(this).find('select[name^="subjects"]').val(),o=$(this).find('input[type="date"]').val();t&&o&&n.subjects.push({subject_code:t,date:o})}),console.log(n);e=new Dialog("Creating Test","Are you sure you want to create this test? "+{formData:n});e.setButtons([{name:"Create Test",class:"btn-success",onClick:function(e){$.ajax({url:"/api/app/create/createtest",type:"POST",data:n,success:function(e){console.log("response",e.message),new Toast("Status","now",e.message).show(),$("#createTestForm").trigger("reset")},error:function(e,t,o){console.error("Error creating test:",o),new Toast("Error","now","Error creating test").show()}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-danger",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show()})}),$("#create-users").on("click",function(){var o=new FormData,n=$('input[name="userType"]:checked').val(),s=$('input[name="role"]:checked').val(),a=$("#formFile")[0].files[0];if("multiple"===n){if(!a)return void alert("Please select a file to upload.");var e=a.name.split(".").pop().toLowerCase();if(-1===[".xls",".xlsx"].indexOf("."+e))return void alert("Please upload a valid Excel file (.xls or .xlsx)")}e=new Dialog("Creating User Profiles","Are you sure you want to create new users");e.setButtons([{name:"Create User",class:"btn-primary",onClick:function(e){o.append("userType",n),o.append("role",s),o.append("users_file",a);var t=new Toast("New","now","Creating profiles");t.show(),$.ajax({url:"/api/app/create/users",type:"POST",data:o,processData:!1,contentType:!1,success:function(e){console.log("User created successfully:",e),(t=new Toast("Success","now",e.successCount+" Users created successfully")).show()},error:function(e){console.log("Error creating user:",e),alert("An error occurred while creating the user. Please try again.")}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){console.log("User creation cancelled."),$(e.data.modal).modal("hide")}}]),e.show()}),$(document).ready(function(){console.log("enrollmennt js loaded"),$("#enroll-subjects").select2({placeholder:"Select subjects",allowClear:!0,width:"100%"})}),$("#fetch-students-btn").on("click",function(e){e.preventDefault(),console.log("fetch-students-btn clicked");var t=new FormData($("#subject-selection-form")[0]);(t.getAll("subjects[]").length?((e=new Dialog("Fetching Students","Are you sure you want to fetch students for the selected subjects?")).setButtons([{name:"Fetch Students",class:"btn-primary",onClick:function(e){new Toast("Fetching","now","Fetching students").show(),$.ajax({url:"/api/app/template/enrollsubstud",type:"POST",data:t,processData:!1,contentType:!1,success:function(e){console.log("Students fetched successfully:",e),new Toast("Success","now","Students fetched successfully").show(),$("#subjects-list-container").empty(),"string"==typeof e?$("#subjects-list-container").append(e):e&&e.html?$("#subjects-list-container").append(e.html):console.error("Unexpected response format:",e),$("#subjects-list-container").show()},error:function(e){(errortoast=new Toast("Failed","now","Students not found")).show(),console.error("Error fetching students:",e)}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){new Toast("Cancelled","now","Fetching students cancelled").show(),$(e.target).closest(".modal").modal("hide")}}]),e):new Toast("Error","now","Please select subjects")).show()}),$(document).ready(function(){$("#signOutBtn").on("click",function(e){e.preventDefault();e=new Dialog("Sign out Confirmation","Are you sure you want to sign out?");e.setButtons([{name:"Sign Out",class:"btn-danger",onClick:function(e){$.ajax({url:"/api/auth/logout",type:"POST",success:function(e){window.location.href="/"},error:function(e){alert("Error signing out. Please try again.")}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-success",onClick:function(e){console.log("User canceled sign out."),$(e.data.modal).modal("hide")}}]),e.show()})}),$("#generateExcel-btn").click(function(){var e=new FormData,o=$("#batch").val(),n=$("#semester").val(),s=$("#section").val(),a=$("#subject_code").val(),r=$("#department").val(),c=$("#test_name").val(),t=$("#faculty_id").val();e.append("batch",o),e.append("semester",n),e.append("section",s),e.append("subject_code",a),e.append("department",r),e.append("test_name",c),e.append("faculty_id",t),console.log(o,n,s,a,r,c,t),console.log(e),$.ajax({url:"/generate_class_sub_excel",type:"POST",data:e,processData:!1,contentType:!1,xhrFields:{responseType:"blob"},success:function(e){var e=window.URL.createObjectURL(e),t=document.createElement("a");t.href=e,t.download="report_"+o+"_"+n+"_"+s+"_"+a+"_"+r+"_"+c+".xlsx",t.click(),window.URL.revokeObjectURL(e)},error:function(e,t,o){console.error("Error:",o)}})}),$(document).ready(function(){let r="/api/app/permission",n=$("#permissionForm"),s=$("#permissionsTable"),c=!1,i=null;function l(e){s.find(`tr[data-id="${e.permission_id}"]`).remove();e=`
                <tr data-id="${e.permission_id}">
                    <td>${e.permission_name}</td>
                    <td>${e.description}</td>
                    <td>${e.permission_category}</td>
                    <td>
                        <button class="btn btn-warning btn-sm editPermission" data-id="${e.permission_id}" data-name="${e.permission_name}">Edit</button>
                        <button class="btn btn-danger btn-sm deletePermission" data-id="${e.permission_id}" data-name="${e.permission_name}">Delete</button> 
                    </td>
                </tr>
            `;s.prepend(e)}function d(){n[0].reset()}$(n).on("submit",function(e){e.preventDefault();let t=document.getElementById("permission_name").value,o=document.getElementById("description").value,n=document.getElementById("permission_category").value,s={permission_name:t,description:o,permission_category:n};var a;c?(s.permission_id=i||null,(a=new Dialog("Update Permission",'<div style="font-size: 16px; line-height: 1.6;"><strong>Are you sure you want to update the permission as below?</strong><br><br><strong>Permission Name:</strong> '+t+"<br><strong>Description:</strong> "+o+"<br><strong>Permission Category:</strong> "+n+"<br></div>")).setButtons([{name:"Update",class:"btn-primary",onClick:function(e){$.ajax({url:r+"/update",method:"POST",data:s,success:function(e){new Toast("now","success",e.message).show();e={permission_name:t,description:o,permission_category:n,permission_id:e.permission_id};console.log(e),l(e),d(),$('#permissionForm button[type="submit"]').text("Create"),c=!1,i=null,$("#cancelPermission").remove()},error:function(e){let t="An error occurred";t=409===e.status?"No changes Made.":500===e.status?"Please try again later.":e.responseJSON?.message||"Unknown error occurred.",new Toast("now","error",t).show(),console.error("Error creating permission:",e),d(),$('#permissionForm button[type="submit"]').text("Create"),c=!1,i=null,$("#cancelPermission").remove()}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){d(),$('#permissionForm button[type="submit"]').text("Create"),c=!1,i=null,$("#cancelPermission").remove(),$(e.data.modal).modal("hide")}}])):(a=new Dialog("Create Permission",'<div style="font-size: 16px; line-height: 1.6;"><strong>Are you sure you want to create the permission below?</strong><br><br><strong>Permission Name:</strong> '+t+"<br><strong>Description:</strong> "+o+"<br><strong>Permission Category:</strong> "+n+"<br></div>")).setButtons([{name:"Create",class:"btn-primary",onClick:function(e){$.ajax({url:r+"/create",method:"POST",data:s,success:function(e){new Toast("now","success",e.message).show();e={permission_name:t,description:o,permission_category:n,permission_id:e.permissionId};l(e)},error:function(e){let t="An error occurred";t=409===e.status?"The permission already exists.":500===e.status?"Please try again later.":e.responseJSON?.message||"Unknown error occurred.",new Toast("now","error",t).show(),console.error("Error creating permission:",e)}}),d(),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){d(),$(e.data.modal).modal("hide")}}]),a.show()}),$(document).on("click",".editPermission",function(){var t,e=$(this).data("id"),e=($(this).data("name"),t=e),o=function(e){console.log("permission_name: "+e.permission_name),console.log("description: "+e.description),$("#permission_name").val(e.permission_name),$("#description").val(e.description),$("#permission_category").val(e.permission_category),c=!0,i=t,$('#permissionForm button[type="submit"]').text("Update"),$("#cancelPermission").length||$("#permissionForm").append('<button type="button" class="btn btn-secondary" id="cancelPermission" style="display:inline-block">Cancel</button>'),$("html, body").animate({scrollTop:n.offset().top},500)};e={permission_id:t},$.ajax({url:"/api/app/permission/get/by/id",method:"POST",data:e,success:function(e){console.log(e),o({permission_name:e.permission_name,description:e.description,permission_category:e.permission_category})},error:function(){new Toast("now","error","An error occurred").show()}})}),$(document).on("click","#cancelPermission",function(){console.log("Cancel button clicked"),d(),$('#permissionForm button[type="submit"]').text("Create"),c=!1,i=null,$("#cancelPermission").remove()}),$(document).on("click",".deletePermission",function(){var e=$(this).data("id"),t=$(this).data("name"),o=e,e=t;(e=new Dialog("Delete Permission","Are you sure you want to delete the permission "+e+"?")).setButtons([{name:"Delete",class:"btn-danger",onClick:function(e){var t;$.ajax({url:r+"/delete",method:"POST",data:{permission_id:o},success:function(){new Toast("now","success","Permission deleted successfully").show()},error:function(e,t,o){console.error("Error deleting permission"),new Toast("now","error","An error occurred").show()}}),t=o,s.find(`tr[data-id="${t}"]`).remove(),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show()})}),$(document).ready(function(){$("#student-select").on("change",function(){var e=this.options[this.selectedIndex],t=e.dataset.regno,o=e.dataset.name,e=e.dataset.marks;$("#reg-no").val(t),$("#student-name").val(o),$("#current-marks").val(e),$("#update-form").removeClass("d-none")}),$("#reset-btn").on("click",function(){$("#student-select").val(""),$("#update-form").addClass("d-none")}),$("#update-btn").on("click",function(){var e=$("#reg-no").val(),o=$("#updated-marks").val(),n=$("#update-form"),s=n.data("batch"),a=n.data("semester"),r=n.data("subject_code"),c=n.data("testname"),i=n.data("section"),n=n.data("department");if(console.log(e,o,s,a,r,c,i,n),o.trim()){(updatingToast=new Toast("Updating","now","Updating marks")).show();let t=new FormData;t.append("reg_no",e),t.append("new_mark",o),t.append("batch",s),t.append("semester",a),t.append("subject_code",r),t.append("testname",c),t.append("section",i),t.append("department",n);e=new Dialog("Update Marks","Are you sure to update mark as "+o+"?");e.setButtons([{name:"Update Mark",class:"btn-success",onClick:function(e){$.ajax({url:"/api/app/update/updatemark",type:"POST",data:t,processData:!1,contentType:!1,success:function(e){console.log("Marks updated successfully:",e),new Toast("Success","now","Marks updated successfully").show(),$("#update-form").find("input").val(""),$("#student-select").val("").trigger("change"),$("#update-form").addClass("d-none")},error:function(e){console.error("Error updating marks:",e),(errortoast=new Toast("Failed","now","Marks not updated")).show()}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){new Toast("Cancelled","now","Update Marks Cancelled").show(),$(e.data.modal).modal("hide")}}]),e.show()}else alert("Please enter new marks.")}),$("#back-btn").on("click",function(){window.history.back()}),$("#edit-back-btn").on("click",function(){window.history.back()})}),$(document).ready(function(){console.log("Role Permission Manage JS Loaded [updated]");let a=[];var e;$("#role-permission-search").on("input",function(){let n=$(this).val().toLowerCase();$("#permissions-container .mb-3").each(function(){var e=$(this),t=e.find(".form-check");let o=!1;t.each(function(){var e=$(this).find("label").text().toLowerCase().includes(n);$(this).toggle(e),e&&(o=!0)}),o?(e.show(),e.find(".collapse").collapse("show")):e.hide()})}),e="",$.ajax({url:"/api/app/permission/get/all",method:"POST",data:{search:e},success:function(e){var t=(a=e.map(e=>({id:e._id.$oid,name:e.permission_name,category:e.permission_category,description:e.description}))).reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{}),o=$("#permissions-container");for(s in o.empty(),t){var n=t[s],s=`
                    <div class="mb-3">
                        <ul class="list-unstyled">
                            <li>
                                <button type="button" class="btn w-100 text-start" data-bs-toggle="collapse" data-bs-target="#category-${s}">
                                    <i class="fas fa-chevron-right" id="arrow-${s}"></i> ${s}
                                </button>

                                
                                <div id="category-${s}" class="collapse mb-3">
                                    <ul class="list-unstyled ms-4">
                                        ${n.map(e=>`
                                            <li>
                                                <div class="form-check">
                                                    <input class="form-check-input permission-checkbox" type="checkbox" name="permissions[]" 
                                                        value="${e.id}" id="perm-${e.id}">
                                                    <label class="form-check-label" for="perm-${e.id}" data-bs-toggle="tooltip" 
                                                        data-bs-placement="right" title="${e.description}">
                                                        ${e.name}
                                                    </label>
                                                </div>
                                            </li>
                                        `).join("")}
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </div>
                `;o.append(s)}$('[data-bs-toggle="tooltip"]').tooltip(),o.on("click",".select-all",function(){var e=$(this).data("category"),e=$("#category-"+e);e.collapse("show"),e.find(".permission-checkbox").prop("checked",!0)}),o.on("click",".deselect-all",function(){var e=$(this).data("category");$("#category-"+e).find(".permission-checkbox").prop("checked",!1)}),o.on("show.bs.collapse",function(e){e=e.target.id.replace("category-","");$("#arrow-"+e).removeClass("fa-chevron-right").addClass("fa-chevron-down")}),o.on("hide.bs.collapse",function(e){e=e.target.id.replace("category-","");$("#arrow-"+e).removeClass("fa-chevron-down").addClass("fa-chevron-right")})},error:function(e){console.error("Error fetching permissions:",e)}})}),console.log("sidebar.js loaded"),Array.from(document.querySelectorAll('[data-bs-toggle="tooltip"]')).forEach(e=>{new bootstrap.Tooltip(e),console.log("tooltipTriggerEl:",e)});
//# sourceMappingURL=app.min.js.map