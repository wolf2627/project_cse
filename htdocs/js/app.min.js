function loadAssignRoleForms(){var e=document.getElementById("assign-roles-operation").value;let t=document.getElementById("assign-roles-dynamic-form");t.innerHTML="","assign"===e?(console.log("assign clicked"),fetch("/api/app/template/assignrole/type?operation=assign").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'})):"unassign"===e&&fetch("/api/app/template/unassignrole?operation=unassign").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'})}function loadAssignRoleForms2(){var e=document.getElementById("AssignRole-UserType").value;let t=document.getElementById("assign-roles-other-fields-dynamic-form");t.innerHTML="",fetch("/api/app/template/assignrole/otherfields?category="+e).then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'})}function setCookie(e,t,o){var s,n="";o&&((s=new Date).setTime(s.getTime()+24*o*60*60*1e3),n="; expires="+s.toUTCString()),document.cookie=e+"="+t+n+"; path=/"}function loadRolesForm(){var e=document.getElementById("manage-roles-operation").value;let t=document.getElementById("manage-roles-dynamic-form");t.innerHTML="","create"===e?fetch("/api/app/template/createrole?operation=create").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'}):"update"===e?fetch("/api/app/template/updaterole?operation=update").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'}):"delete"===e&&fetch("/api/app/template/deleterole?operation=delete").then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="alert alert-danger">An error occurred.</div>'})}function manageRoleSubmitForm(e){var t=new FormData;let o;"create"===e?(t.append("roleName",document.getElementById("roleName").value),t.append("roleCategory",document.getElementById("roleCategory").value),t.append("description",document.getElementById("description").value),o="/api/app/role/create"):"update"===e?(t.append("roleId",document.getElementById("roleId").value),t.append("roleName",document.getElementById("roleName").value),t.append("description",document.getElementById("description").value),o="/api/app/role/update"):"delete"===e&&(t.append("roleId",document.getElementById("roleId").value),o="/api/app/role/delete"),fetch(o,{method:"POST",body:t}).then(e=>e.json()).then(e=>{document.getElementById("result");(e.success?new Toast("Success","now",e.message):new Toast("Failure","now",e.message)).show(),loadRolesForm()}).catch(e=>{console.error("Error:",e),new Toast("Error","now","An error occurred.").show(),loadRolesForm()})}$(document).ready(function(){console.log("Assign Faculty js loaded"),$("#studentSections").select2({placeholder:"Student Sections",allowClear:!0,width:"100%"})}),$(document).ready(function(){$("#classForm").on("submit",function(e){e.preventDefault();let t={faculty_id:$("#facultyId").val(),subject_code:$("#subjectCode").val(),batch:$("#batch").val(),department:$("#department").val(),semester:$("#semester").val(),section:$("#section").val(),student_sections:$("#studentSections").val(),year:$("#year").val()};console.log("Form Data:",t);e=new Dialog("Assigning Faculty","Are you sure you want to assign faculty to the selected sections? "+{formData:t});e.setButtons([{name:"Assign Faculty",class:"btn-success",onClick:function(e){$.ajax({url:"/api/app/create/assignfaculty",type:"POST",data:t,success:function(e){console.log("response",e.message),new Toast("Status","now",e.message).show(),$("#classForm").trigger("reset")},error:function(e,t,o){console.error("Error assigning faculty:",o),new Toast("Error","now","Error assigning faculty").show()}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-danger",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show()})}),$("#class-wise-year-report-btn").click(function(){var e=this.value,s=document.getElementById("test_name_class_wise_year").value,n=document.getElementById("batch_class_wise_year").value,a=document.getElementById("department_class_wise_year").value,r=document.getElementById("semester_class_wise_year").value,s=s.replace(/\s/g,"");new Toast("Report","Now","Report is being generated.").show(),$.ajax({url:"/generate_year_report_classwise",type:"POST",data:{test_id:e},xhrFields:{responseType:"blob"},success:function(e){var t=new Date,t=t.getFullYear()+("0"+(t.getMonth()+1)).slice(-2)+("0"+t.getDate()).slice(-2)+("0"+t.getHours()).slice(-2)+("0"+t.getMinutes()).slice(-2)+("0"+t.getSeconds()).slice(-2),e=(new Toast("Report","Success","Report generated successfully.").show(),URL.createObjectURL(e)),o=document.createElement("a");o.href=e,o.download=s+a+n+r+"_Report_"+t+".pdf",document.body.appendChild(o),o.click(),document.body.removeChild(o)},error:function(e,t,o){new Toast("Report","Error","An error occurred while generating the report.").show()}})}),$(document).ready(function(){console.log("createadmin is ready"),$("#admin-create-account-btn").click(function(){console.log("create admin account clicked");var e,t=$("#admin-username").val(),o=$("#admin-password").val(),s=$("#admin-email").val(),n=$("#admin-confirm-password").val();console.log("username: "+t),console.log("password: "+o),console.log("email: "+s),console.log("confirm_password: "+n),o!==n?alert("Passwords do not match"):((e=new FormData).append("user",t),e.append("password",o),e.append("email",s),e.append("confirm_password",n),$.ajax({url:"/api/app/create/admin",type:"POST",data:e,processData:!1,contentType:!1,success:function(e){console.log("create admin account success"),console.log(e),("success"===e.message?new Toast("now","success","Admin account created successfully"):new Toast("now","error","Error creating admin account")).show()},error:function(e){console.log("create admin account error"),console.log(e),new Toast("now","error","Error creating admin account").show()}}))})}),$("#create-subjects").on("click",function(){var e,o=new FormData,s=$("#subjectFile")[0].files[0];s?(e=s.name.split(".").pop().toLowerCase(),-1===[".xls",".xlsx"].indexOf("."+e)?alert("Please upload a valid Excel file (.xls or .xlsx)"):((e=new Dialog("Creating Subjects","Are you sure you want to create new subjects? ")).setButtons([{name:"Create Subjects",class:"btn-primary",onClick:function(e){o.append("subjects_file",s);var t=new Toast("New","now","Creating subjects");t.show(),$.ajax({url:"/api/app/create/subjects",type:"POST",data:o,processData:!1,contentType:!1,success:function(e){console.log("Subjects created successfully:",e),(t=new Toast("Success","now",e.successCount+" Subjects created successfully")).show()},error:function(e){console.log("Error creating subjects:",e),alert("An error occurred while creating subjects. Please try again.")}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){console.log("Subject creation cancelled."),$(e.data.modal).modal("hide")}}]),e.show())):alert("Please select a file to upload.")}),$(document).ready(function(){console.log("create test js loaded [new]");let s=1;$("#subjectsContainer").on("click",function(e){var t,o;$(e.target).hasClass("addSubjectBtn")?(e.preventDefault(),t=$("#subjectTemplate").html(),(o=$("<div>").addClass("input-group mb-2")).html(`
                <select class="form-select" name="subjects[${s}][code]" required>
                    ${t}
                </select>
                <input type="date" class="form-control" name="subjects[${s}][date]" required>
                <button type="button" class="btn btn-danger removeSubjectBtn">-</button>
            `),$("#subjectsContainer").append(o),s++):$(e.target).hasClass("removeSubjectBtn")&&$(e.target).closest(".input-group").remove()})}),$(document).ready(function(){console.log("create test js loaded [form]"),$("#createTestForm").on("submit",function(e){e.preventDefault();let s={testname:$("#testname").val(),month:$("#month").val(),batch:$("#batch").val(),semester:$("#semester").val(),year:$("#year").val(),department:$("#department").val(),subjects:[],duration:$("#duration").val(),totalmarks:$("#totalmarks").val(),passmarks:$("#passmarks").val(),instructions:$("#instructions").val()};$("#subjectsContainer .input-group").each(function(e){var t=$(this).find('select[name^="subjects"]').val(),o=$(this).find('input[type="date"]').val();t&&o&&s.subjects.push({subject_code:t,date:o})}),console.log(s);e=new Dialog("Creating Test","Are you sure you want to create this test? "+{formData:s});e.setButtons([{name:"Create Test",class:"btn-success",onClick:function(e){$.ajax({url:"/api/app/create/createtest",type:"POST",data:s,success:function(e){console.log("response",e.message),new Toast("Status","now",e.message).show(),$("#createTestForm").trigger("reset")},error:function(e,t,o){console.error("Error creating test:",o),new Toast("Error","now","Error creating test").show()}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-danger",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show()})}),$("#create-users").on("click",function(){var o=new FormData,s=$('input[name="userType"]:checked').val(),n=$('input[name="role"]:checked').val(),a=$("#formFile-usercreate")[0].files[0];if("multiple"===s){if(!a)return void alert("Please select a file to upload.");var e=a.name.split(".").pop().toLowerCase();if(-1===[".xls",".xlsx"].indexOf("."+e))return void alert("Please upload a valid Excel file (.xls or .xlsx)")}e=new Dialog("Creating User Profiles","Are you sure you want to create new users");e.setButtons([{name:"Create User",class:"btn-primary",onClick:function(e){o.append("userType",s),o.append("role",n),o.append("users_file",a);var t=new Toast("New","now","Creating profiles");t.show(),$.ajax({url:"/api/app/create/users",type:"POST",data:o,processData:!1,contentType:!1,success:function(e){console.log("User created successfully:",e),(t=new Toast("Success","now",e.successCount+" Users created successfully")).show()},error:function(e){console.log("Error creating user:",e),alert("An error occurred while creating the user. Please try again.")}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){console.log("User creation cancelled."),$(e.data.modal).modal("hide")}}]),e.show(),$("#formFile-usercreate").val("")}),$("#create-users-clear").on("click",function(){$("#formFile-usercreate").val("")}),$(document).ready(function(){console.log("enrollmennt js loaded"),$("#enroll-subjects").select2({placeholder:"Select subjects",allowClear:!0,width:"100%"})}),$("#fetch-students-btn").on("click",function(e){e.preventDefault(),console.log("fetch-students-btn clicked");var t=new FormData($("#subject-selection-form")[0]);(t.getAll("subjects[]").length?((e=new Dialog("Fetching Students","Are you sure you want to fetch students for the selected subjects?")).setButtons([{name:"Fetch Students",class:"btn-primary",onClick:function(e){new Toast("Fetching","now","Fetching students").show(),$.ajax({url:"/api/app/template/enrollsubstud",type:"POST",data:t,processData:!1,contentType:!1,success:function(e){console.log("Students fetched successfully:",e),new Toast("Success","now","Students fetched successfully").show(),$("#subjects-list-container").empty(),"string"==typeof e?$("#subjects-list-container").append(e):e&&e.html?$("#subjects-list-container").append(e.html):console.error("Unexpected response format:",e),$("#subjects-list-container").show()},error:function(e){(errortoast=new Toast("Failed","now","Students not found")).show(),console.error("Error fetching students:",e)}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){new Toast("Cancelled","now","Fetching students cancelled").show(),$(e.target).closest(".modal").modal("hide")}}]),e):new Toast("Error","now","Please select subjects")).show()}),$(document).ready(function(){setInterval(function(){var e=$("#footer-text-1"),t=$("#footer-text-2");e.is(":visible")?e.fadeOut("slow",function(){t.fadeIn("slow")}):t.fadeOut("slow",function(){e.fadeIn("slow")})},5e3)}),$(document).ready(function(){$("#signOutBtn").on("click",function(e){e.preventDefault();e=new Dialog("Sign out Confirmation","Are you sure you want to sign out?");e.setButtons([{name:"Sign Out",class:"btn-danger",onClick:function(e){$.ajax({url:"/api/auth/logout",type:"POST",success:function(e){window.location.href="/"},error:function(e){alert("Error signing out. Please try again.")}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-success",onClick:function(e){console.log("User canceled sign out."),$(e.data.modal).modal("hide")}}]),e.show()})}),$("#generateExcel-btn").click(function(){var e=new FormData,o=$("#batch").val(),s=$("#semester").val(),n=$("#section").val(),a=$("#subject_code").val(),r=$("#department").val(),c=$("#test_name").val(),t=$("#faculty_id").val();e.append("batch",o),e.append("semester",s),e.append("section",n),e.append("subject_code",a),e.append("department",r),e.append("test_name",c),e.append("faculty_id",t),console.log(o,s,n,a,r,c,t),console.log(e),$.ajax({url:"/generate_class_sub_excel",type:"POST",data:e,processData:!1,contentType:!1,xhrFields:{responseType:"blob"},success:function(e){var e=window.URL.createObjectURL(e),t=document.createElement("a");t.href=e,t.download="report_"+o+"_"+s+"_"+n+"_"+a+"_"+r+"_"+c+".xlsx",t.click(),window.URL.revokeObjectURL(e)},error:function(e,t,o){console.error("Error:",o)}})}),$(document).ready(function(){let r="/api/app/permission",s=$("#permissionForm"),n=$("#permissionsTable"),c=!1,l=null;function i(e){n.find(`tr[data-id="${e.permission_id}"]`).remove();e=`
                <tr data-id="${e.permission_id}">
                    <td>${e.permission_name}</td>
                    <td>${e.description}</td>
                    <td>${e.permission_category}</td>
                    <td>
                        <button class="btn btn-warning btn-sm editPermission" data-id="${e.permission_id}" data-name="${e.permission_name}">Edit</button>
                        <button class="btn btn-danger btn-sm deletePermission" data-id="${e.permission_id}" data-name="${e.permission_name}">Delete</button> 
                    </td>
                </tr>
            `;n.prepend(e)}function d(){s[0].reset()}$(s).on("submit",function(e){e.preventDefault();let t=document.getElementById("permission_name").value,o=document.getElementById("description").value,s=document.getElementById("permission_category").value,n={permission_name:t,description:o,permission_category:s};var a;c?(n.permission_id=l||null,(a=new Dialog("Update Permission",'<div style="font-size: 16px; line-height: 1.6;"><strong>Are you sure you want to update the permission as below?</strong><br><br><strong>Permission Name:</strong> '+t+"<br><strong>Description:</strong> "+o+"<br><strong>Permission Category:</strong> "+s+"<br></div>")).setButtons([{name:"Update",class:"btn-primary",onClick:function(e){$.ajax({url:r+"/update",method:"POST",data:n,success:function(e){new Toast("now","success",e.message).show();e={permission_name:t,description:o,permission_category:s,permission_id:e.permission_id};console.log(e),i(e),d(),$('#permissionForm button[type="submit"]').text("Create"),c=!1,l=null,$("#cancelPermission").remove()},error:function(e){let t="An error occurred";t=409===e.status?"No changes Made.":500===e.status?"Please try again later.":e.responseJSON?.message||"Unknown error occurred.",new Toast("now","error",t).show(),console.error("Error creating permission:",e),d(),$('#permissionForm button[type="submit"]').text("Create"),c=!1,l=null,$("#cancelPermission").remove()}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){d(),$('#permissionForm button[type="submit"]').text("Create"),c=!1,l=null,$("#cancelPermission").remove(),$(e.data.modal).modal("hide")}}])):(a=new Dialog("Create Permission",'<div style="font-size: 16px; line-height: 1.6;"><strong>Are you sure you want to create the permission below?</strong><br><br><strong>Permission Name:</strong> '+t+"<br><strong>Description:</strong> "+o+"<br><strong>Permission Category:</strong> "+s+"<br></div>")).setButtons([{name:"Create",class:"btn-primary",onClick:function(e){$.ajax({url:r+"/create",method:"POST",data:n,success:function(e){new Toast("now","success",e.message).show();e={permission_name:t,description:o,permission_category:s,permission_id:e.permissionId};i(e)},error:function(e){let t="An error occurred";t=409===e.status?"The permission already exists.":500===e.status?"Please try again later.":e.responseJSON?.message||"Unknown error occurred.",new Toast("now","error",t).show(),console.error("Error creating permission:",e)}}),d(),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){d(),$(e.data.modal).modal("hide")}}]),a.show()}),$(document).on("click",".editPermission",function(){var t,e=$(this).data("id"),e=($(this).data("name"),t=e),o=function(e){console.log("permission_name: "+e.permission_name),console.log("description: "+e.description),$("#permission_name").val(e.permission_name),$("#description").val(e.description),$("#permission_category").val(e.permission_category),c=!0,l=t,$('#permissionForm button[type="submit"]').text("Update"),$("#cancelPermission").length||$("#permissionForm").append('<button type="button" class="btn btn-secondary" id="cancelPermission" style="display:inline-block">Cancel</button>'),$("html, body").animate({scrollTop:s.offset().top},500)};e={permission_id:t},$.ajax({url:"/api/app/permission/get/by/id",method:"POST",data:e,success:function(e){console.log(e),o({permission_name:e.permission_name,description:e.description,permission_category:e.permission_category})},error:function(){new Toast("now","error","An error occurred").show()}})}),$(document).on("click","#cancelPermission",function(){console.log("Cancel button clicked"),d(),$('#permissionForm button[type="submit"]').text("Create"),c=!1,l=null,$("#cancelPermission").remove()}),$(document).on("click",".deletePermission",function(){var e=$(this).data("id"),t=$(this).data("name"),o=e,e=t;(e=new Dialog("Delete Permission","Are you sure you want to delete the permission "+e+"?")).setButtons([{name:"Delete",class:"btn-danger",onClick:function(e){var t;$.ajax({url:r+"/delete",method:"POST",data:{permission_id:o},success:function(){new Toast("now","success","Permission deleted successfully").show()},error:function(e,t,o){console.error("Error deleting permission"),new Toast("now","error","An error occurred").show()}}),t=o,n.find(`tr[data-id="${t}"]`).remove(),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show()})}),$(document).ready(function(){$("#student-select").on("change",function(){var e=this.options[this.selectedIndex],t=e.dataset.regno,o=e.dataset.name,e=e.dataset.marks;$("#reg-no").val(t),$("#student-name").val(o),$("#current-marks").val(e),$("#update-form").removeClass("d-none")}),$("#reset-btn").on("click",function(){$("#student-select").val(""),$("#update-form").addClass("d-none")}),$("#update-btn").on("click",function(){var e=$("#reg-no").val(),o=$("#updated-marks").val(),s=$("#update-form"),n=s.data("batch"),a=s.data("semester"),r=s.data("subject_code"),c=s.data("testname"),l=s.data("section"),s=s.data("department");if(console.log(e,o,n,a,r,c,l,s),o.trim()){(updatingToast=new Toast("Updating","now","Updating marks")).show();let t=new FormData;t.append("reg_no",e),t.append("new_mark",o),t.append("batch",n),t.append("semester",a),t.append("subject_code",r),t.append("testname",c),t.append("section",l),t.append("department",s);e=new Dialog("Update Marks","Are you sure to update mark as "+o+"?");e.setButtons([{name:"Update Mark",class:"btn-success",onClick:function(e){$.ajax({url:"/api/app/update/updatemark",type:"POST",data:t,processData:!1,contentType:!1,success:function(e){console.log("Marks updated successfully:",e),new Toast("Success","now","Marks updated successfully").show(),$("#update-form").find("input").val(""),$("#student-select").val("").trigger("change"),$("#update-form").addClass("d-none")},error:function(e){console.error("Error updating marks:",e),(errortoast=new Toast("Failed","now","Marks not updated")).show()}}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){new Toast("Cancelled","now","Update Marks Cancelled").show(),$(e.data.modal).modal("hide")}}]),e.show()}else alert("Please enter new marks.")}),$("#back-btn").on("click",function(){window.history.back()}),$("#edit-back-btn").on("click",function(){window.history.back()})}),Array.from(document.querySelectorAll('[data-bs-toggle="tooltip"]')).forEach(e=>{new bootstrap.Tooltip(e)}),$(document).ready(function(){let t=$(".sidebar-cus"),o=$(".sidebar-expand"),s=$(".sidebar-overlay");o.click(function(){t.toggleClass("visible"),s.toggleClass("visible")}),$(document).click(function(e){t.is(e.target)||t.has(e.target).length||o.is(e.target)||o.has(e.target).length||(t.removeClass("visible"),s.removeClass("visible"))}),t.click(function(e){e.stopPropagation()}),o.click(function(e){e.stopPropagation()})}),$(document).ready(function(){console.log("Role Permission Manage JS Loaded [updated]");let a=[],r=[];async function t(e=""){return console.log("Loading Permissions"),$("#permissions-container").empty(),a=[],$.ajax({url:"/api/app/permission/get/all",method:"POST",data:{search:e},success:function(e){a=e.map(e=>({id:e._id.$oid,name:e.permission_name,category:e.permission_category,description:e.description})),console.log("Permissions Data Loaded:",a)},error:function(e){console.error("Error fetching permissions:",e)}})}function o(){console.log("Generating Permissions UI");let o=r.map(e=>e.id);var e,t=a.reduce((e,t)=>(e[t.category]=e[t.category]||[],e[t.category].push(t),e),{}),s=$("#permissions-container");for(e in s.empty(),t){var n=t[e],n=`
                <div class="mb-3">
                    <ul class="list-unstyled">
                        <li>
                            <button type="button" class="btn w-100 text-start" data-bs-toggle="collapse" data-bs-target="#category-${e}">
                                <i class="fas fa-chevron-right" id="arrow-${e}"></i> ${e}
                            </button>
                            <div id="category-${e}" class="collapse mb-3 show">
                                <ul class="list-unstyled ms-4">
                                    ${n.map(e=>{var t=o.includes(e.id)?"checked":"";return`
                                            <li>
                                                <div class="form-check">
                                                    <input class="form-check-input permission-checkbox" type="checkbox" name="permissions[]" 
                                                        value="${e.id}" id="perm-${e.id}" ${t}>
                                                    <label class="form-check-label" for="perm-${e.id}" data-bs-toggle="tooltip" 
                                                        data-bs-placement="right" title="${e.description}">
                                                        ${e.name}
                                                    </label>
                                                </div>
                                            </li>
                                        `}).join("")}
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>`;s.append(n)}$('[data-bs-toggle="tooltip"]').tooltip()}function s(e=0){r=(a=(1==e||$("#rolePermissionForm").trigger("reset"),$("#permissions-container").empty(),[]),[])}$("#permission-role").on("change",function(){let e=$(this).val();console.log("Role Changed to:",e),s(1),(async()=>{try{console.log("Loading role and permissions"),await Promise.all([(async e=>(console.log("Loading Role Permissions"),r=[],$.ajax({url:"/api/app/permission/get/by/role",method:"POST",data:{roleId:e},success:function(e){e.success&&Array.isArray(e.permission)?(r=e.permission.map(e=>({id:e.id,name:e.name,category:e.category,description:e.description})),console.log("Role Permissions Loaded:",r)):console.error("Invalid response structure:",e)},error:function(e){console.error("Error fetching role permissions:",e)}})))(e),t()]),console.log("Permissions and Role Data Loaded"),o()}catch(e){console.error("Error loading role and permissions:",e),t().then(()=>o())}})()}),$("#role-permission-search").on("input",function(){let s=$(this).val().toLowerCase();$("#permissions-container .mb-3").each(function(){var e=$(this),t=e.find(".form-check");let o=!1;t.each(function(){var e=$(this).find("label").text().toLowerCase().includes(s);$(this).toggle(e),e&&(o=!0)}),o?(e.show(),e.find(".collapse").collapse("show")):e.hide()})}),$("#rolePermissionForm").on("submit",function(e){e.preventDefault();var e=$("#permission-role").val(),t=$("input[name='permissions[]']:checked").map(function(){return $(this).val()}).get();let o=new FormData;o.append("roleId",e),t.forEach(e=>{o.append("permissionsID[]",e)}),$.ajax({url:"/api/app/permission/grant",method:"POST",processData:!1,contentType:!1,data:o,success:function(e){console.log("Permissions updated successfully:",e);var t=new Toast("now"," success","Permissions updated successfully");0<e.message.length&&(e=e.message.map(function(e){return e.name}),(e=new Dialog("Success Details",`<h6>Current Permissions for Role: ${$("#permission-role").find("option:selected").data("name")} </h6>
                                         <ul>
                                             <li>${e.join("</li><li>")}</li>
                                         </ul>`)).setButtons([{name:"Close",class:"btn-primary",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show()),s(),t.show()},error:function(e){console.error("Error saving permissions:",e),new Toast("now"," error","Error saving permissions").show()}})})}),console.log("sidebar.js loaded"),Array.from(document.querySelectorAll('[data-bs-toggle="tooltip"]')).forEach(e=>{new bootstrap.Tooltip(e),console.log("tooltipTriggerEl:",e)}),$(document).ready(function(){$("#tt-subject_code").on("change",function(){var e=$(this).val();$.ajax({url:"/api/app/get/tt/batch",data:{subject_code:e},type:"POST",success:function(e){$("#tt-subject_name").val(e.subject_name);var o=$("#tt-batch");new Toast("now","success","Batches Loaded").show(),console.log(e.batches),$("#tt-batch").prop("disabled",!1),o.empty(),o.append($("<option>",{value:"",text:"Select the Batch"})),$.each(e.batches,function(e,t){o.append($("<option>",{value:t,text:t}))})},error:function(e){new Toast("now","error","No Batch Found. Please Assign the Subject to the Batch").show(),$("#tt-batch").prop("disabled",!0)}})}),$("#tt-batch").on("change",function(){console.log("Batch Changed");var e=$("#tt-subject_code").val(),t=$(this).val();console.log(e),console.log(t),$.ajax({url:"/api/app/get/tt/faculty",data:{subject_code:e,batch:t},type:"POST",success:function(e){console.log(e),$("#tt-faculty").empty(),$("#tt-faculty").prop("disabled",!1),$("#tt-semester").prop("disabled",!1),new Toast("now","success","Faculties Loaded").show(),$("#tt-faculty").append($("<option>",{value:"",text:"Select the Faculty"})),$.each(e.faculties,function(e,t){$("#tt-faculty").append($("<option>",{value:t.id,text:t.name+" ("+t.department+")"}))})},error:function(e){new Toast("now","error","No faculty Found. Please Assign the Subject to the faculty").show()}})}),$("#tt-faculty").on("change",function(){var e=$("#tt-subject_code").val(),t=$("#tt-batch").val(),o=$("#tt-semester").val(),s=$(this).val();$.ajax({url:"/api/app/get/tt/class",data:{faculty_id:s,subject_code:e,batch:t,semester:o},type:"POST",success:function(e){console.log(e),new Toast("now","success","Class Loaded").show(),$("#tt-section").val(e.classes.section),$("#tt-class_id").val(e.classes.class_id)},error:function(e){new Toast("now","error","No Class Found. Please Assign the Subject to the Class").show()}})}),$("#tt-submit-btn").on("click",function(e){e.preventDefault();var t,o,s,n,a,r,c,l,i,d,u,e=document.getElementById("timetable-form");e.checkValidity()?(l=$("#tt-department").val(),t=$("#tt-subject_code").val(),o=$("#tt-batch").val(),s=$("#tt-semester").val(),n=$("#tt-faculty").val(),a=$("#tt-class_id").val(),r=$("#tt-section").val(),c=$("#tt-day").val(),l=$("#tt-class-department").val(),d=$("#tt-room").val(),i=$("#tt-slot").val(),d=l+d,console.log(t,o,s,n,a,r,c,i,d),(u=new FormData).append("department",l),u.append("subject_code",t),u.append("batch",o),u.append("semester",s),u.append("faculty_id",n),u.append("class_id",a),u.append("section",r),u.append("day",c),u.append("slot",i),u.append("class_room",d),console.log("Form Data Loaded"),$.ajax({url:"/api/app/get/tt/assignslot",data:u,type:"POST",processData:!1,contentType:!1,success:function(e){new Toast("now","success","Timetable Slot Added").show(),console.log("Response:",e)},error:function(e,t){e=e.responseJSON?e.responseJSON.message:"Error Adding Timetable Slot";new Toast("now","error",e).show(),console.error("Error:",t)}})):e.classList.add("was-validated")})}),$(document).ready(function(){function r(e,t){console.log("Loading Roles");var o=new FormData;o.append("category",e),o.append("user_id",t),$.ajax({url:"/api/app/template/userrole",method:"POST",data:o,processData:!1,contentType:!1,success:function(e){console.log("Roles fetched successfully"),c("Roles","Roles Fetched Successfully"),$("#roles-container").html(e),$('[data-bs-toggle="tooltip"]').tooltip(),console.log("Roles Loaded")},error:function(e,t,o){console.error("Error fetching roles:",o),c("Error","Failed to fetch roles.")}})}function c(e,t){new Toast("now",e,t).show()}function l(){$("#role-user-id").val(""),$("#user-info").html(""),$("#roles-container").html(""),console.log("Removing Submit Button"),$("#user-role-submit").removeClass("d-block"),$("#user-role-submit").addClass("d-none")}console.log("User Role Manage JS Loaded"),$("#user-role-category").on("change",function(){console.log("Category Changed:",$(this).val()),l()}),$("#role-fetch-user").on("click",function(){console.log("User Role Fetch Button Clicked"),$("#user-info").html(""),$("#roles-container").html("");let n=$("#role-user-id").val(),a=$("#user-role-category").val();if(a)if(n){var t=new FormData;let e="";if(t.append("category",a),"faculty"===a)t.append("facultyId",n),e="/api/app/get/faculty";else{if("student"!==a)return void console.error("Invalid category selected.");t.append("regNo",n),e="/api/app/get/student"}fetch(e,{method:"POST",body:t}).then(t=>t.ok?t.json():t.json().then(e=>{throw console.error("Error fetching user details:",e.message||"Unknown error occurred"),c("Error",e.message||"Error fetching user details"),new Error(`HTTP Error ${t.status}: `+t.statusText)})).then(o=>{if(!o._id)throw new Error("Unexpected response structure");{c("User Details","User Fetched Successfully");var s=`
                                <div class="col-md-12">
                                    <p><strong>Name:</strong> <em>${o.name}</em></p>
                                    <p><strong>Email:</strong> <em>${o.email}</em></p>
                                    <p><strong>Department:</strong> <em>${o.department||"N/A"}</em></p>
                                    <p><strong>Designation:</strong> <em>${o.designation||"N/A"}</em></p>
                                    <p><strong>Role:</strong> <em>${o.role||"N/A"}</em></p>
                                </div>
                    `;let t=`
                <strong>Name: </strong> ${o.name}</em>, 
                <strong>Department: </strong> ${o.department||"N/A"}</em>, 
                <strong>Role: </strong> ${o.role||"N/A"}</em>
                `,e=new Dialog("User Details",s);e.setButtons([{name:"Confirm",class:"btn-success",onClick:function(e){$("#user-info").html(t),r(a,n),console.log("Enabling Submit Button"),$("#user-role-submit").removeClass("d-none"),$("#user-role-submit").addClass("d-block"),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){l(),$(e.data.modal).modal("hide")}}]),e.show()}}).catch(e=>{console.error("Fetch error:",e)})}else console.error("User ID/Registration No cannot be empty.");else console.error("Please select a category first.")}),$("#user-role-submit").on("click",function(e){console.log("User Role Submit Button Clicked");let o=$("#user-role-category").val(),s=$("#role-user-id").val();if(o)if(s){var n=$("input[name='role[]']:checked").map(function(){return $(this).val()}).get();0===n.length&&(console.error("No roles selected."),n=[]),console.log("Selected Category:",o),console.log("Selected User ID:",s),console.log("Selected Roles:",n);let t=new FormData;t.append("category",o),t.append("user_id",s),n.forEach(e=>{t.append("roles_id[]",e)}),console.log("Submitting form data:",t),$.ajax({url:"/api/app/role/set",method:"POST",contentType:!1,processData:!1,data:t,success:function(e){e&&e.message&&0!==e.message.length?(console.log("Roles assigned successfully:",e),c("Success","Roles assigned successfully!"),Array.isArray(e.result)&&0<e.result.length?(e=e.result.map(function(e){return e.name}),(e=new Dialog("Success",`<h6>Current Roles for User: ${$("#role-user-id").val()} </h6>
                        <ul>
                            ${e.map(e=>`<li>${e}</li>`).join("")}
                        </ul>`)).setButtons([{name:"Close",class:"btn-info",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show(),r(o,s)):((e=new Dialog("Success",`<h6>Current Roles for User: ${$("#role-user-id").val()} </h6>
                        <p>No Roles Assigned</p>`)).setButtons([{name:"Close",class:"btn-secondary",onClick:function(e){$(e.data.modal).modal("hide")}}]),e.show())):c("Success","No roles assigned")},error:function(e,t,o){console.error("Error assigning roles:",o),c("Error","Failed to assign roles. Please try again.")}})}else console.error("User ID/Registration No cannot be empty.");else console.error("Please select a category first.")})});
//# sourceMappingURL=app.min.js.map